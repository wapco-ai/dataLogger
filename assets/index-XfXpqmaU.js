import{r as g,j as e,D as le,a as ce,b as de,T as H,F as N,I as $,S as ue,M as A,c as ee,d as C,C as I,R as Se,e as U,f as pe,B as W,g as Y,h as K,P as lt,i as ct,k as dt,l as G,m as ut,A as pt,n as ht,u as mt,o as gt,p as xt,q as jt,s as _,t as ft,v as yt,w as kt,x as bt,y as St,z as vt,E as Mt,G as Pt,L as ae,H as wt,J as ie,K as Ct,N as $e,O as Dt,Q as Ot,U as At,V as Tt,W as We,X as be,Y as Fe,Z as It,_ as Re,$ as Et,a0 as Lt,a1 as Nt,a2 as $t}from"./vendor-3RgnH-9C.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&p(c)}).observe(document,{childList:!0,subtree:!0});function k(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function p(a){if(a.ep)return;a.ep=!0;const r=k(a);fetch(a.href,r)}})();function Wt({location:s,gpsMeta:i,onClose:k,onSave:p}){const[a,r]=g.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[c,u]=g.useState(""),d=(l,o)=>{r(m=>({...m,[l]:o}))},b=l=>{r(o=>({...o,transportModes:{...o.transportModes,[l]:!o.transportModes[l]}}))},y=()=>{if(!a.name.trim()){u("Ù†Ø§Ù… Ú¯Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return}const l=Object.keys(a.transportModes).filter(o=>a.transportModes[o]);p({...a,latitude:s.lat,longitude:s.lng,timestamp:new Date().toISOString(),transportModes:l,gpsMeta:i?{coords:{latitude:i.coords.latitude,longitude:i.coords.longitude,accuracy:i.coords.accuracy,altitude:i.coords.altitude,speed:i.coords.speed,heading:i.coords.heading},timestamp:i.timestamp}:null}),k()};return e.jsxs(le,{open:!0,onClose:k,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(ce,{sx:{textAlign:"center",fontWeight:"bold"},children:"Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±Ù‡ Ø¬Ø¯ÛŒØ¯"}),e.jsxs(de,{dividers:!0,sx:{direction:"rtl"},children:[c&&e.jsx("div",{style:{color:"red",marginBottom:"16px",textAlign:"center"},children:c}),e.jsx(H,{label:"Ù†Ø§Ù… Ú¯Ø±Ù‡",fullWidth:!0,margin:"normal",value:a.name,onChange:l=>d("name",l.target.value),required:!0,sx:{direction:"rtl"}}),e.jsx(H,{label:"ØªÙˆØ¶ÛŒØ­Ø§Øª",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:a.description,onChange:l=>d("description",l.target.value),sx:{direction:"rtl"}}),e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx($,{children:"Ù†ÙˆØ¹ Ú¯Ø±Ù‡"}),e.jsxs(ue,{value:a.type,onChange:l=>d("type",l.target.value),label:"Ù†ÙˆØ¹ Ú¯Ø±Ù‡",children:[e.jsx(A,{value:"checkpoint",children:"Ù†Ù‚Ø·Ù‡ Ø¨Ø§Ø²Ø±Ø³ÛŒ"}),e.jsx(A,{value:"landmark",children:"Ù†Ø´Ø§Ù†Ù‡"}),e.jsx(A,{value:"poi",children:"Ù†Ù‚Ø·Ù‡ Ø¯Ù„Ø®ÙˆØ§Ù‡"}),e.jsx(A,{value:"other",children:"Ø³Ø§ÛŒØ±"})]})]}),e.jsxs(N,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx($,{shrink:!0,children:"Ø´ÛŒÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„"}),e.jsxs(ee,{children:[e.jsx(C,{control:e.jsx(I,{checked:a.transportModes.wheelchair,onChange:()=>b("wheelchair")}),label:"ÙˆÛŒÙ„Ú†Ø±"}),e.jsx(C,{control:e.jsx(I,{checked:a.transportModes.electricVan,onChange:()=>b("electricVan")}),label:"ÙˆÙ† Ø¨Ø±Ù‚ÛŒ"}),e.jsx(C,{control:e.jsx(I,{checked:a.transportModes.walking,onChange:()=>b("walking")}),label:"Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ"})]})]}),e.jsxs(N,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx($,{shrink:!0,children:"Ø¬Ù†Ø³ÛŒØª ØªØ±Ø¯Ø¯"}),e.jsxs(Se,{value:a.gender,onChange:l=>d("gender",l.target.value),children:[e.jsx(C,{value:"male",control:e.jsx(U,{}),label:"Ù…Ø±Ø¯Ø§Ù†Ù‡"}),e.jsx(C,{value:"female",control:e.jsx(U,{}),label:"Ø²Ù†Ø§Ù†Ù‡"}),e.jsx(C,{value:"family",control:e.jsx(U,{}),label:"Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"})]})]})]}),e.jsxs(pe,{children:[e.jsx(W,{onClick:k,color:"secondary",children:"Ø§Ù†ØµØ±Ø§Ù"}),e.jsx(W,{onClick:y,color:"primary",variant:"contained",children:"Ø°Ø®ÛŒØ±Ù‡"})]})]})}function Ft({onSave:s,onClose:i,pathCoordinates:k}){const[p,a]=g.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[r,c]=g.useState(""),u=(y,l)=>{a(o=>({...o,[y]:l}))},d=y=>{a(l=>({...l,transportModes:{...l.transportModes,[y]:!l.transportModes[y]}}))},b=()=>{if(!p.name.trim()){c("Ù†Ø§Ù… Ù…Ø³ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return}const y=Object.keys(p.transportModes).filter(l=>p.transportModes[l]);s({...p,transportModes:y,coordinates:k,timestamp:new Date().toISOString()}),i()};return e.jsxs(le,{open:!0,onClose:i,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(ce,{sx:{textAlign:"center",fontWeight:"bold"},children:"Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø³ÛŒØ± Ø¬Ø¯ÛŒØ¯"}),e.jsxs(de,{dividers:!0,children:[r&&e.jsx("div",{style:{color:"red",marginBottom:"16px",textAlign:"center"},children:r}),e.jsx(H,{label:"Ù†Ø§Ù… Ù…Ø³ÛŒØ±",fullWidth:!0,margin:"normal",value:p.name,onChange:y=>u("name",y.target.value),required:!0}),e.jsx(H,{label:"ØªÙˆØ¶ÛŒØ­Ø§Øª",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:p.description,onChange:y=>u("description",y.target.value)}),e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx($,{children:"Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±"}),e.jsxs(ue,{value:p.type,onChange:y=>u("type",y.target.value),label:"Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±",children:[e.jsx(A,{value:"hiking",children:"Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ"}),e.jsx(A,{value:"driving",children:"Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ"}),e.jsx(A,{value:"other",children:"Ø³Ø§ÛŒØ±"})]})]}),e.jsxs(N,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx($,{shrink:!0,children:"Ø´ÛŒÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„"}),e.jsxs(ee,{children:[e.jsx(C,{control:e.jsx(I,{checked:p.transportModes.wheelchair,onChange:()=>d("wheelchair")}),label:"ÙˆÛŒÙ„Ú†Ø±"}),e.jsx(C,{control:e.jsx(I,{checked:p.transportModes.electricVan,onChange:()=>d("electricVan")}),label:"ÙˆÙ† Ø¨Ø±Ù‚ÛŒ"}),e.jsx(C,{control:e.jsx(I,{checked:p.transportModes.walking,onChange:()=>d("walking")}),label:"Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ"})]})]}),e.jsxs(N,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx($,{shrink:!0,children:"Ø¬Ù†Ø³ÛŒØª ØªØ±Ø¯Ø¯"}),e.jsxs(Se,{value:p.gender,onChange:y=>u("gender",y.target.value),children:[e.jsx(C,{value:"male",control:e.jsx(U,{}),label:"Ù…Ø±Ø¯Ø§Ù†Ù‡"}),e.jsx(C,{value:"female",control:e.jsx(U,{}),label:"Ø²Ù†Ø§Ù†Ù‡"}),e.jsx(C,{value:"family",control:e.jsx(U,{}),label:"Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"})]})]})]}),e.jsxs(pe,{children:[e.jsx(W,{onClick:i,color:"secondary",children:"Ø§Ù†ØµØ±Ø§Ù"}),e.jsx(W,{onClick:b,color:"primary",variant:"contained",children:"Ø°Ø®ÛŒØ±Ù‡"})]})]})}const Rt=[{key:"saturday",label:"Ø´Ù†Ø¨Ù‡"},{key:"sunday",label:"ÛŒÚ©â€ŒØ´Ù†Ø¨Ù‡"},{key:"monday",label:"Ø¯ÙˆØ´Ù†Ø¨Ù‡"},{key:"tuesday",label:"Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡"},{key:"wednesday",label:"Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡"},{key:"thursday",label:"Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡"},{key:"friday",label:"Ø¬Ù…Ø¹Ù‡"}];function Jt({onSave:s,onClose:i,polygonCoordinates:k}){const[p,a]=g.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[r,c]=g.useState(""),[u,d]=g.useState({}),b=(o,m)=>a(S=>({...S,[o]:m})),y=o=>a(m=>({...m,transportModes:{...m.transportModes,[o]:!m.transportModes[o]}})),l=()=>{if(!p.name.trim()){c("Ù†Ø§Ù… Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return}const o=Object.keys(p.transportModes).filter(m=>p.transportModes[m]);s({...p,transportModes:o,coordinates:k,restrictedTimes:u,timestamp:new Date().toISOString()}),i()};return e.jsxs(le,{open:!0,onClose:i,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(ce,{sx:{textAlign:"center",fontWeight:"bold"},children:"Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø¬Ø¯ÛŒØ¯"}),e.jsxs(de,{dividers:!0,children:[r&&e.jsx("div",{style:{color:"red",marginBottom:16,textAlign:"center"},children:r}),e.jsx(H,{label:"Ù†Ø§Ù… Ù…Ø­Ø¯ÙˆØ¯Ù‡",fullWidth:!0,margin:"normal",value:p.name,onChange:o=>b("name",o.target.value),required:!0}),e.jsx(H,{label:"ØªÙˆØ¶ÛŒØ­Ø§Øª",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:p.description,onChange:o=>b("description",o.target.value)}),e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx($,{children:"Ù†ÙˆØ¹ Ù…Ø­Ø¯ÙˆØ¯Ù‡"}),e.jsxs(ue,{value:p.type,onChange:o=>b("type",o.target.value),label:"Ù†ÙˆØ¹ Ù…Ø­Ø¯ÙˆØ¯Ù‡",children:[e.jsx(A,{value:"park",children:"Ù¾Ø§Ø±Ú©"}),e.jsx(A,{value:"zone",children:"Ù…Ø­Ø¯ÙˆØ¯Ù‡"}),e.jsx(A,{value:"other",children:"Ø³Ø§ÛŒØ±"})]})]}),e.jsxs(N,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx($,{shrink:!0,children:"Ø´ÛŒÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„"}),e.jsxs(ee,{children:[e.jsx(C,{control:e.jsx(I,{checked:p.transportModes.wheelchair,onChange:()=>y("wheelchair")}),label:"ÙˆÛŒÙ„Ú†Ø±"}),e.jsx(C,{control:e.jsx(I,{checked:p.transportModes.electricVan,onChange:()=>y("electricVan")}),label:"ÙˆÙ† Ø¨Ø±Ù‚ÛŒ"}),e.jsx(C,{control:e.jsx(I,{checked:p.transportModes.walking,onChange:()=>y("walking")}),label:"Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ"})]})]}),e.jsxs(N,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx($,{shrink:!0,children:"Ø¬Ù†Ø³ÛŒØª ØªØ±Ø¯Ø¯"}),e.jsxs(Se,{value:p.gender,onChange:o=>b("gender",o.target.value),children:[e.jsx(C,{value:"male",control:e.jsx(U,{}),label:"Ù…Ø±Ø¯Ø§Ù†Ù‡"}),e.jsx(C,{value:"female",control:e.jsx(U,{}),label:"Ø²Ù†Ø§Ù†Ù‡"}),e.jsx(C,{value:"family",control:e.jsx(U,{}),label:"Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"})]})]}),e.jsx(Y,{variant:"subtitle1",sx:{fontWeight:"bold",mt:2,mb:1},children:e.jsx("span",{style:{borderBottom:"2px solid #999",paddingBottom:3},children:"Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒ"})}),e.jsx(K,{children:Rt.map(o=>e.jsxs(lt,{elevation:u[o.key]?2:0,sx:{mb:1,borderRadius:3,p:1,bgcolor:u[o.key]?"#f5f5f5":"transparent",transition:"background .2s"},children:[e.jsx(K,{display:"flex",alignItems:"center",children:e.jsx(C,{control:e.jsx(ct,{checked:!!u[o.key],color:"primary",onChange:m=>{d(S=>m.target.checked?{...S,[o.key]:[{start:"",end:""}]}:Object.fromEntries(Object.entries(S).filter(([v])=>v!==o.key)))}}),label:e.jsx(Y,{sx:{fontWeight:"bold"},children:o.label}),labelPlacement:"start",sx:{flex:1,mr:1}})}),e.jsx(dt,{in:!!u[o.key],children:e.jsxs(K,{mt:1,pl:2,pr:1,children:[(u[o.key]||[]).map((m,S)=>e.jsxs(K,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(H,{size:"small",label:"Ø§Ø²",type:"time",value:m.start,onChange:v=>{const w=v.target.value;d(h=>({...h,[o.key]:h[o.key].map((x,P)=>P===S?{...x,start:w}:x)}))},variant:"outlined",sx:{width:105,mx:.5,direction:"ltr",bgcolor:"#fff"},InputLabelProps:{shrink:!0,sx:{right:0,fontWeight:"bold"}},inputProps:{step:300,dir:"ltr",style:{textAlign:"center"}}}),e.jsx(Y,{variant:"body2",sx:{mx:1},children:"ØªØ§"}),e.jsx(H,{size:"small",label:"ØªØ§",type:"time",value:m.end,onChange:v=>{const w=v.target.value;d(h=>({...h,[o.key]:h[o.key].map((x,P)=>P===S?{...x,end:w}:x)}))},variant:"outlined",sx:{width:105,mx:.5,direction:"ltr",bgcolor:"#fff"},InputLabelProps:{shrink:!0,sx:{right:0,fontWeight:"bold"}},inputProps:{step:300,dir:"ltr",style:{textAlign:"center"}}}),e.jsx(G,{onClick:()=>d(v=>({...v,[o.key]:v[o.key].filter((w,h)=>h!==S)})),size:"small",color:"error",sx:{mx:.5},disabled:u[o.key].length===1,children:e.jsx(ut,{fontSize:"small"})})]},S)),e.jsx(W,{onClick:()=>d(m=>({...m,[o.key]:[...m[o.key],{start:"",end:""}]})),color:"primary",size:"small",startIcon:e.jsx(pt,{}),sx:{mt:1,fontWeight:"bold"},children:"Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø§Ø²Ù‡"})]})})]},o.key))})]}),e.jsxs(pe,{children:[e.jsx(W,{onClick:i,color:"secondary",children:"Ø§Ù†ØµØ±Ø§Ù"}),e.jsx(W,{onClick:l,color:"primary",variant:"contained",children:"Ø°Ø®ÛŒØ±Ù‡"})]})]})}const Ut=[{value:"checkpoint",label:"Ù†Ù‚Ø·Ù‡ Ø¨Ø§Ø²Ø±Ø³ÛŒ"},{value:"landmark",label:"Ù†Ø´Ø§Ù†Ù‡"},{value:"poi",label:"Ù†Ù‚Ø·Ù‡ Ø¯Ù„Ø®ÙˆØ§Ù‡"},{value:"other",label:"Ø³Ø§ÛŒØ±"}],zt=[{value:"hiking",label:"Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ"},{value:"driving",label:"Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ"},{value:"other",label:"Ø³Ø§ÛŒØ±"}];function Bt({isOpen:s,onClose:i,filterOptions:k,setFilterOptions:p}){const a=(r,c)=>{p(u=>{const d=u[r]||[];return{...u,[r]:d.includes(c)?d.filter(b=>b!==c):[...d,c]}})};return e.jsxs(le,{open:s,onClose:i,maxWidth:"xs",fullWidth:!0,dir:"rtl",children:[e.jsx(ce,{sx:{fontWeight:"bold",textAlign:"center"},children:"ÙÛŒÙ„ØªØ±Ø³Ø§Ø²ÛŒ"}),e.jsxs(de,{children:[e.jsxs(K,{sx:{mb:2},children:[e.jsx(Y,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Ù†ÙˆØ¹ Ù†Ø´Ø§Ù†Ú¯Ø±"}),e.jsx(ee,{children:Ut.map(r=>e.jsx(C,{control:e.jsx(I,{checked:k.markerTypes.includes(r.value),onChange:()=>a("markerTypes",r.value)}),label:r.label},r.value))})]}),e.jsx(ht,{sx:{my:1}}),e.jsxs(K,{children:[e.jsx(Y,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±"}),e.jsx(ee,{children:zt.map(r=>e.jsx(C,{control:e.jsx(I,{checked:k.pathTypes.includes(r.value),onChange:()=>a("pathTypes",r.value)}),label:r.label},r.value))})]})]}),e.jsx(pe,{children:e.jsx(W,{onClick:i,color:"primary",fullWidth:!0,variant:"contained",sx:{fontWeight:"bold",borderRadius:2},children:"Ø¨Ø³ØªÙ†"})})]})}const Vt=({selectedItem:s,onDelete:i,onClose:k})=>{var c,u,d,b,y,l,o,m,S,v,w;const p=h=>!h||h.length===0?"Ù†Ø¯Ø§Ø±Ø¯":h.map(x=>{switch(x){case"wheelchair":return"ÙˆÛŒÙ„Ú†Ø±";case"electricVan":return"ÙˆÙ† Ø¨Ø±Ù‚ÛŒ";case"walking":return"Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ";default:return x}}).join(", "),a=h=>Array.isArray(h)?Array.isArray(h[0])?h:h.map(x=>x.coordinates||[]):[],r=h=>{const x=a(h);if(x.length<2)return 0;let P=0;for(let O=1;O<x.length;O++){const[z,q]=x[O-1],[n,j]=x[O];P+=L.latLng(z,q).distanceTo(L.latLng(n,j))}return(P/1e3).toFixed(2)};return e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",borderRadius:"10px",boxShadow:"0 4px 15px rgba(0,0,0,0.2)",width:"90%",maxWidth:"400px",maxHeight:"80vh",overflowY:"auto",zIndex:1e3},children:[e.jsxs("h2",{style:{marginBottom:"15px",textAlign:"center",color:"#333"},children:["Ø¬Ø²Ø¦ÛŒØ§Øª ",s.type==="marker"?"Ù†Ø´Ø§Ù†Ú¯Ø±":s.type==="path"?"Ù…Ø³ÛŒØ±":s.type==="polygon"?"Ù…Ø­Ø¯ÙˆØ¯Ù‡":""]}),e.jsxs("div",{style:{backgroundColor:"#f4f4f4",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ù†Ø§Ù…:"})," ",((c=s.item.data)==null?void 0:c.name)||s.item.name||"Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ØªÙˆØ¶ÛŒØ­Ø§Øª:"})," ",((u=s.item.data)==null?void 0:u.description)||s.item.description||"Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª"]})]}),s.type==="marker"&&e.jsxs("div",{style:{backgroundColor:"#e9f5e9",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ù†ÙˆØ¹ Ù†Ø´Ø§Ù†Ú¯Ø±:"})," ",((d=s.item.data)==null?void 0:d.type)||"Ù†Ø§Ù…Ø´Ø®Øµ"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ø´ÛŒÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„:"})," ",p((b=s.item.data)==null?void 0:b.transportModes)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ø¬Ù†Ø³ÛŒØª ØªØ±Ø¯Ø¯:"}),((y=s.item.data)==null?void 0:y.gender)==="male"?"Ù…Ø±Ø¯Ø§Ù†Ù‡":((l=s.item.data)==null?void 0:l.gender)==="female"?"Ø²Ù†Ø§Ù†Ù‡":((o=s.item.data)==null?void 0:o.gender)==="family"?"Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ":"Ù†Ø§Ù…Ø´Ø®Øµ"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ:"}),`${s.item.position[0].toFixed(4)}, ${s.item.position[1].toFixed(4)}`]})]}),s.type==="path"&&e.jsxs("div",{style:{backgroundColor:"#e6f2ff",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±:"})," ",s.item.type||"Ù†Ø§Ù…Ø´Ø®Øµ"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ø·ÙˆÙ„ Ù…Ø³ÛŒØ±:"})," ",r(s.item.coordinates)," Ú©ÛŒÙ„ÙˆÙ…ØªØ±"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø§Ø· Ù…Ø³ÛŒØ±:"})," ",((m=s.item.coordinates)==null?void 0:m.length)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯:"})," ",new Date(s.item.timestamp).toLocaleDateString("fa-IR")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ø¯Ù‚Øª GPS:"}),(v=(S=s.item.gpsMeta)==null?void 0:S.coords)!=null&&v.accuracy?`${s.item.gpsMeta.coords.accuracy} Ù…ØªØ±`:"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª"]})]}),s.type==="polygon"&&e.jsxs("div",{style:{backgroundColor:"#f5f4e6",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ù†Ø§Ù… Ù…Ø­Ø¯ÙˆØ¯Ù‡:"})," ",s.item.name||"Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ØªÙˆØ¶ÛŒØ­Ø§Øª:"})," ",s.item.description||"Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ù†ÙˆØ¹ Ù…Ø­Ø¯ÙˆØ¯Ù‡:"})," ",s.item.type||"Ù†Ø§Ù…Ø´Ø®Øµ"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ø´ÛŒÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„:"})," ",(s.item.transportModes||[]).join(", ")||"Ù†Ø¯Ø§Ø±Ø¯"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ø¬Ù†Ø³ÛŒØª ØªØ±Ø¯Ø¯:"})," ",s.item.gender==="male"?"Ù…Ø±Ø¯Ø§Ù†Ù‡":s.item.gender==="female"?"Ø²Ù†Ø§Ù†Ù‡":s.item.gender==="family"?"Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ":"Ù†Ø§Ù…Ø´Ø®Øµ"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø§Ø·:"})," ",((w=s.item.coordinates)==null?void 0:w.length)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯:"})," ",new Date(s.item.timestamp).toLocaleDateString("fa-IR")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª:"}),e.jsx("br",{}),s.item.restrictedTimes&&Object.keys(s.item.restrictedTimes).length>0?e.jsx("ul",{style:{margin:0,paddingRight:18},children:Object.entries(s.item.restrictedTimes).map(([h,x])=>e.jsxs("li",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:{saturday:"Ø´Ù†Ø¨Ù‡",sunday:"ÛŒÚ©â€ŒØ´Ù†Ø¨Ù‡",monday:"Ø¯ÙˆØ´Ù†Ø¨Ù‡",tuesday:"Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡",wednesday:"Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡",thursday:"Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡",friday:"Ø¬Ù…Ø¹Ù‡"}[h]}),":"," ",x.map((P,O)=>e.jsxs("span",{children:[P.start," - ",P.end,O<x.length-1?" ØŒ ":""]},O))]},h))}):"Ù…Ø­Ø¯ÙˆØ¯ÛŒØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"15px"},children:[e.jsxs("button",{onClick:i,style:{backgroundColor:"#dc3545",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{children:"ğŸ—‘ï¸"})," Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ø´ÙˆØ¯"]}),e.jsxs("button",{onClick:k,style:{backgroundColor:"#6c757d",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{children:"âœ–"})," Ø§Ù†ØµØ±Ø§Ù"]})]})]})},Gt=()=>{const[s,i]=g.useState(()=>{const r=localStorage.getItem("mapMarkers");return r?JSON.parse(r):[]});return g.useEffect(()=>{localStorage.setItem("mapMarkers",JSON.stringify(s))},[s]),{markers:s,addMarker:r=>{i(c=>[...c,{...r,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removeMarker:r=>{i(c=>c.filter(u=>u.id!==r))},updateMarker:(r,c)=>{i(u=>u.map(d=>d.id===r?{...d,...c}:d))}}},Ht=()=>{const[s,i]=g.useState(()=>{const r=localStorage.getItem("mapPaths");return r?JSON.parse(r):[]});return g.useEffect(()=>{localStorage.setItem("mapPaths",JSON.stringify(s))},[s]),{paths:s,addPath:r=>{i(c=>[...c,{...r,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removePath:r=>{i(c=>c.filter(u=>u.id!==r))},updatePath:(r,c)=>{i(u=>u.map(d=>d.id===r?{...d,...c}:d))}}},_t=()=>{const[s,i]=g.useState(()=>{const r=localStorage.getItem("mapPolygons");return r?JSON.parse(r):[]});return g.useEffect(()=>{localStorage.setItem("mapPolygons",JSON.stringify(s))},[s]),{polygons:s,addPolygon:r=>{i(c=>[...c,{...r,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removePolygon:r=>{i(c=>c.filter(u=>u.id!==r))},updatePolygon:(r,c)=>{i(u=>u.map(d=>d.id===r?{...d,...c}:d))}}},Kt=(s="geojson")=>{const i=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),k=JSON.parse(localStorage.getItem("mapPaths")||"[]"),p=JSON.parse(localStorage.getItem("mapPolygons")||"[]");let a,r,c;function u(o){return Array.isArray(o)?o.join(","):typeof o=="object"&&o!==null?Object.entries(o).filter(([m,S])=>S).map(([m])=>m).join(","):""}switch(s){case"geojson":const o={type:"FeatureCollection",features:[...i.map(n=>{var j,M;return{type:"Feature",geometry:{type:"Point",coordinates:[n.position[1],n.position[0]]},properties:{...n.data||{},transportModes:((j=n.data)==null?void 0:j.transportModes)||[],gender:((M=n.data)==null?void 0:M.gender)||""}}}),...k.map(n=>({type:"Feature",geometry:{type:"LineString",coordinates:Array.isArray(n.coordinates)?typeof n.coordinates[0]=="object"&&Array.isArray(n.coordinates[0].coordinates)?n.coordinates.map(j=>[j.coordinates[1],j.coordinates[0]]):n.coordinates.map(j=>[j[1],j[0]]):[]},properties:{name:n.name,description:n.description,type:n.type,timestamp:n.timestamp,transportModes:n.transportModes||[],gender:n.gender||""}})),...p.map(n=>({type:"Feature",geometry:{type:"Polygon",coordinates:[n.coordinates.map(j=>[j[1],j[0]])]},properties:{name:n.name,description:n.description,type:n.type,timestamp:n.timestamp,transportModes:n.transportModes||[],gender:n.gender||"",restrictedTimes:n.restrictedTimes||{}}}))]};a=JSON.stringify(o,null,2),r="application/geo+json",c="geojson";break;case"kml":const m=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
<Document>
`,S=`</Document>
</kml>`,v=i.map(n=>{const j=n.data||{},M=u(j.transportModes);return`
      <Placemark>
        <name>${j.name||""}</name>
        <description>${j.description||""}</description>
        <ExtendedData>
          <Data name="type"><value>${j.type||""}</value></Data>
          <Data name="transportModes"><value>${M}</value></Data>
          <Data name="gender"><value>${j.gender||""}</value></Data>
        </ExtendedData>
        <Point>
          <coordinates>${n.position[1]},${n.position[0]},0</coordinates>
        </Point>
      </Placemark>
      `}).join(""),w=k.map(n=>{const M=(Array.isArray(n.coordinates)?typeof n.coordinates[0]=="object"&&Array.isArray(n.coordinates[0].coordinates)?n.coordinates.map(T=>T.coordinates):n.coordinates:[]).map(T=>`${T[1]},${T[0]},0`).join(" "),E=u(n.transportModes);return`
      <Placemark>
        <name>${n.name||""}</name>
        <description>${n.description||""}</description>
        <ExtendedData>
          <Data name="type"><value>${n.type||""}</value></Data>
          <Data name="transportModes"><value>${E}</value></Data>
          <Data name="gender"><value>${n.gender||""}</value></Data>
        </ExtendedData>
        <LineString>
          <coordinates>
            ${M}
          </coordinates>
        </LineString>
      </Placemark>
      `}).join(""),h=p.map(n=>{const j=u(n.transportModes);let M=Array.isArray(n.coordinates)?n.coordinates.slice():[];M.length&&(M[0][0]!==M[M.length-1][0]||M[0][1]!==M[M.length-1][1])&&M.push(M[0]);const E=M.map(T=>`${T[1]},${T[0]},0`).join(" ");return`
    <Placemark>
      <name>${n.name||""}</name>
      <description>${n.description||""}</description>
      <ExtendedData>
        <Data name="type"><value>${n.type||""}</value></Data>
        <Data name="transportModes"><value>${j}</value></Data>
        <Data name="gender"><value>${n.gender||""}</value></Data>
        <Data name="restrictedTimes"><value>${n.restrictedTimes?JSON.stringify(n.restrictedTimes):""}</value></Data>
      </ExtendedData>
      <Polygon>
        <outerBoundaryIs>
          <LinearRing>
            <coordinates>
              ${E}
            </coordinates>
          </LinearRing>
        </outerBoundaryIs>
      </Polygon>
    </Placemark>
  `}).join("");a=m+v+w+h+S,r="application/vnd.google-earth.kml+xml",c="kml";break;case"csv":const x=`Type,Name,Description,PathType,TransportModes,Gender,Latitude,Longitude,Timestamp
`,P=i.map(n=>{const j=n.data||{};return["Point",`"${j.name||""}"`,`"${j.description||""}"`,"",`"${u(j.transportModes)}"`,`"${j.gender||""}"`,n.position[0],n.position[1],`"${n.timestamp}"`].join(",")}).join(`
`),O=k.map(n=>{const j=Array.isArray(n.coordinates)?typeof n.coordinates[0]=="object"&&Array.isArray(n.coordinates[0].coordinates)?n.coordinates.map(T=>T.coordinates):n.coordinates:[],[M,E]=j[0]||["",""];return["Line",`"${n.name||""}"`,`"${n.description||""}"`,`"${n.type||""}"`,`"${u(n.transportModes)}"`,`"${n.gender||""}"`,M,E,`"${n.timestamp}"`].join(",")}).join(`
`),z=p.map(n=>{const j=Array.isArray(n.coordinates)?n.coordinates:[],[M,E]=j[0]||["",""];return["Polygon",`"${n.name||""}"`,`"${n.description||""}"`,`"${n.type||""}"`,`"${u(n.transportModes)}"`,`"${n.gender||""}"`,`"${n.restrictedTimes?JSON.stringify(n.restrictedTimes):""}"`,M,E,`"${n.timestamp||""}"`].join(",")}).join(`
`);a=x+P+(P&&(O||z)?`
`:"")+O+(O&&z?`
`:"")+z,r="text/csv",c="csv";break;default:const q={version:"1.0",exportDate:new Date().toISOString(),markers:i,paths:k};a=JSON.stringify(q,null,2),r="application/json",c="json"}const d=new Blob([a],{type:r}),b=URL.createObjectURL(d),y=`map_export_${new Date().toISOString().replace(/[:.]/g,"-")}.${c}`,l=document.createElement("a");l.href=b,l.download=y,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(b)},qt=s=>new Promise((i,k)=>{const p=new FileReader;p.onload=a=>{let r;try{r=JSON.parse(a.target.result)}catch{return k(new Error("Invalid JSON"))}if(r.version&&r.markers&&r.paths){const c=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),u=JSON.parse(localStorage.getItem("mapPaths")||"[]"),d=JSON.parse(localStorage.getItem("mapPolygons")||"[]"),b=r.markers.map(v=>({...v,id:crypto.randomUUID()})),y=r.paths.map(v=>({...v,id:crypto.randomUUID()})),l=Array.isArray(r.polygons)?r.polygons.map(v=>({...v,id:crypto.randomUUID()})):[],o=c.concat(b),m=u.concat(y),S=d.concat(l);return localStorage.setItem("mapMarkers",JSON.stringify(o)),localStorage.setItem("mapPaths",JSON.stringify(m)),localStorage.setItem("mapPolygons",JSON.stringify(S)),i({markers:o,paths:m,polygons:S})}if(r.type==="FeatureCollection"&&Array.isArray(r.features)){const c=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),u=JSON.parse(localStorage.getItem("mapPaths")||"[]"),d=JSON.parse(localStorage.getItem("mapPolygons")||"[]"),b=[],y=[],l=[];r.features.forEach(v=>{const{geometry:w,properties:h={}}=v;if(w){if(w.type==="Point"){const[x,P]=w.coordinates;b.push({id:crypto.randomUUID(),position:[P,x],data:h,timestamp:h.timestamp||new Date().toISOString()})}else if(w.type==="LineString"){const x=w.coordinates.map(([P,O])=>[O,P]);y.push({id:crypto.randomUUID(),name:h.name||"",description:h.description||"",type:h.type||"",coordinates:x,timestamp:h.timestamp||new Date().toISOString()})}else if(w.type==="Polygon"){const x=w.coordinates[0].map(([P,O])=>[O,P]);l.push({id:crypto.randomUUID(),name:h.name||"",description:h.description||"",type:h.type||"",transportModes:h.transportModes||[],gender:h.gender||"",coordinates:x,timestamp:h.timestamp||new Date().toISOString()})}}});const o=c.concat(b),m=u.concat(y),S=d.concat(l);return localStorage.setItem("mapMarkers",JSON.stringify(o)),localStorage.setItem("mapPaths",JSON.stringify(m)),localStorage.setItem("mapPolygons",JSON.stringify(S)),i({markers:o,paths:m,polygons:S})}k(new Error("Invalid import file format"))},p.onerror=()=>k(new Error("File read error")),p.readAsText(s)});function Xt({isTracking:s,onStartTracking:i,onStopTracking:k,onAddMarker:p,onExport:a,onImportClick:r,onFilter:c,onStartManualPath:u,isDrawingPath:d,onStartPolygon:b,isDrawingPolygon:y}){const l=mt(),m=gt(l.breakpoints.down("sm"))?"small":"medium",[S,v]=g.useState(null),w=x=>{v(x.currentTarget)},h=x=>{v(null),x&&typeof a=="function"&&a(x)};return e.jsx(xt,{position:"fixed",color:"inherit",sx:{top:"auto",bottom:0},children:e.jsxs(jt,{sx:{justifyContent:"space-around"},children:[e.jsx(_,{title:s?"ØªÙˆÙ‚Ù Ø±Ø¯ÛŒØ§Ø¨ÛŒ":"Ø´Ø±ÙˆØ¹ Ø±Ø¯ÛŒØ§Ø¨ÛŒ",arrow:!0,children:e.jsx(G,{color:s?"error":"success",onClick:s?k:i,size:m,children:s?e.jsx(ft,{}):e.jsx(yt,{})})}),e.jsx(_,{title:"Ù†Ø´Ø§Ù†Ú¯Ø±",arrow:!0,children:e.jsx(G,{color:"primary",onClick:p,size:m,children:e.jsx(kt,{})})}),e.jsx(_,{title:"Ù…Ø³ÛŒØ± Ø¯Ø³ØªÛŒ",arrow:!0,children:e.jsx(G,{color:d?"success":"primary",onClick:u,size:m,children:e.jsx(bt,{})})}),e.jsx(_,{title:y?"Ø¯Ø± Ø­Ø§Ù„ ØªØ±Ø³ÛŒÙ… Ù…Ø­Ø¯ÙˆØ¯Ù‡":"Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø¬Ø¯ÛŒØ¯",arrow:!0,children:e.jsx(G,{color:y?"success":"primary",onClick:b,size:m,children:e.jsx(St,{})})}),e.jsx(_,{title:"ÙÛŒÙ„ØªØ±",arrow:!0,children:e.jsx(G,{color:"secondary",onClick:c,size:m,children:e.jsx(vt,{})})}),e.jsx(_,{title:"Ø®Ø±ÙˆØ¬ÛŒ",arrow:!0,children:e.jsx(G,{color:"warning",onClick:w,size:m,children:e.jsx(Mt,{})})}),e.jsxs(Pt,{anchorEl:S,open:!!S,onClose:()=>h(),children:[e.jsxs(A,{onClick:()=>h("geojson"),children:[e.jsx(ae,{children:e.jsx(wt,{fontSize:"small"})}),e.jsx(ie,{children:"GeoJSON"})]}),e.jsxs(A,{onClick:()=>h("kml"),children:[e.jsx(ae,{children:e.jsx(Ct,{fontSize:"small"})}),e.jsx(ie,{children:"KML"})]}),e.jsxs(A,{onClick:()=>h("csv"),children:[e.jsx(ae,{children:e.jsx($e,{fontSize:"small"})}),e.jsx(ie,{children:"CSV"})]}),e.jsxs(A,{onClick:()=>h("json"),children:[e.jsx(ae,{children:e.jsx($e,{fontSize:"small"})}),e.jsx(ie,{children:"JSON"})]})]}),e.jsx(_,{title:"ÙˆØ±ÙˆØ¯ÛŒ",arrow:!0,children:e.jsx(G,{color:"inherit",onClick:r,size:m,children:e.jsx(Dt,{})})})]})})}const Zt=Ot.divIcon({className:"custom-marker-icon",html:`
    <div style="
      width: 30px; 
      height: 30px; 
      background-color: #2196F3; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      color: white; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    ">
      ğŸ“
    </div>
  `,iconSize:[30,30],iconAnchor:[15,15]});function Qt({onMapClick:s}){return Nt({click:i=>{s(i.latlng)}}),null}function Yt({position:s,zoom:i}){const k=Lt();return g.useEffect(()=>{s&&k.setView(s,i)},[s,i]),null}const er=()=>{const[s,i]=g.useState([36.2972,59.6067]),[k,p]=g.useState(12),[a,r]=g.useState(null),[c,u]=g.useState(null),[d,b]=g.useState([]),[y,l]=g.useState(null),[o,m]=g.useState(null),[S,v]=g.useState(!1),[w,h]=g.useState(!1),[x,P]=g.useState(null),[O,z]=g.useState(!1),[q,n]=g.useState("street"),j=g.useRef(null),[M,E]=g.useState(null),[T,te]=g.useState(!1),[X,re]=g.useState([]),[Je,ve]=g.useState([]),[he,me]=g.useState(null),[ne,ge]=g.useState(!1),[Z,xe]=g.useState([]),[Me,je]=g.useState(!1),fe=g.useRef(!1),{polygons:Pe,addPolygon:we,removePolygon:Ce}=_t(),Ue=(t="json")=>{Kt(t)},[F,ze]=g.useState({markerTypes:[],pathTypes:[],transportModes:[],gender:[]}),Be={street:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",satellite:"https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2020_3857/default/g/{z}/{y}/{x}.jpg"},{markers:De,addMarker:Oe,removeMarker:Ae}=Gt(),{paths:Te,addPath:ye,removePath:Ie}=Ht(),se=g.useRef(null),Ee=g.useCallback(()=>{if(l(null),!navigator.geolocation){l("Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¯Ø± Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø´Ù…Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯");return}const t={enableHighAccuracy:!0,timeout:3e4,maximumAge:0};navigator.geolocation.getCurrentPosition(f=>{const{latitude:R,longitude:B,accuracy:J}=f.coords,D=[R,B];r(D),E(f),u(J),i(D),p(15)},f=>{switch(f.code){case f.PERMISSION_DENIED:l("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø±Ø¯ Ø´Ø¯");break;case f.POSITION_UNAVAILABLE:l("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª");break;case f.TIMEOUT:l("Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯");break;default:l("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ")}i([36.2972,59.6067]),p(12)},t)},[]),Ve=()=>{te(!0),re([]),l(null)},Ge=()=>{X.length>1?(te(!1),me("manual"),h(!0)):l("Ù…Ø³ÛŒØ± Ø¨Ø³ÛŒØ§Ø± Ú©ÙˆØªØ§Ù‡ Ø§Ø³Øª. Ø­Ø¯Ø§Ù‚Ù„ Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ Ù†ÛŒØ§Ø² Ø§Ø³Øª.")},He=g.useRef(d),_e=()=>{ge(!0),xe([])},Ke=()=>{Z.length>=3?(ge(!1),je(!0)):alert("Ø­Ø¯Ø§Ù‚Ù„ Ø³Ù‡ Ù†Ù‚Ø·Ù‡ Ù†ÛŒØ§Ø² Ø§Ø³Øª.")},qe=t=>{we(t),je(!1),xe([]),ge(!1)};g.useEffect(()=>{He.current=d},[d]);const Xe=()=>{v(!0),b([]),l(null),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{b(t=>(t.length===0&&(ke(),l("Ø¹Ø¯Ù… Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ. Ù„Ø·ÙØ§Ù‹ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")),t))},3e4),se.current=navigator.geolocation.watchPosition(t=>{console.log("GPS update:",t.coords.latitude,t.coords.longitude,"accuracy:",t.coords.accuracy),E(t);const{latitude:f,longitude:R,accuracy:B,altitude:J,speed:D,heading:oe}=t.coords,Q=[f,R];clearTimeout(j.current),B<=5e3&&(r(Q),l(null),b(V=>{if(V.length===0)return[...V,Q];const Le=V[V.length-1],Ne=1e-6;return Math.abs(Le[0]-f)>Ne||Math.abs(Le[1]-R)>Ne?[...V,Q]:V}),ve(V=>[...V,{coords:{latitude:f,longitude:R,accuracy:B,altitude:J,speed:D,heading:oe},timestamp:t.timestamp}]))},t=>{console.error("Tracking error:",t),clearTimeout(j.current);let f="Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª";switch(t.code){case t.PERMISSION_DENIED:f="Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø±Ø¯ Ø´Ø¯";break;case t.POSITION_UNAVAILABLE:f="Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª";break;case t.TIMEOUT:f="Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯";break}l(f),ke()},{enableHighAccuracy:!0,timeout:3e4,maximumAge:0,distanceFilter:1})},ke=()=>{se.current&&(navigator.geolocation.clearWatch(se.current),se.current=null),v(!1),d.length>1?(me("gps"),h(!0)):(b([]),l("Ù…Ø³ÛŒØ± Ø¨Ø³ÛŒØ§Ø± Ú©ÙˆØªØ§Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ù…Ø³Ø§ÙØª Ø¨ÛŒØ´ØªØ±ÛŒ Ø±Ø§ Ø·ÛŒ Ú©Ù†ÛŒØ¯."))},Ze=t=>{P({type:"marker",item:t})},Qe=t=>{P({type:"path",item:t})},Ye=()=>{if(x){const{type:t,item:f}=x;t==="marker"?Ae(f.id):t==="path"?Ie(f.id):t==="polygon"&&Ce(f.id),P(null)}},et=t=>{ye({...t,coordinates:d,pointsMeta:Je}),h(!1),b([]),ve([])};g.useEffect(()=>{Ee()},[Ee]);const tt=t=>{if(fe.current){fe.current=!1;return}if(!(x||Me||w||o)){if(ne){xe(f=>[...f,[t.lat,t.lng]]);return}if(T){re(f=>[...f,{coordinates:[t.lat,t.lng],gpsMeta:M?{coords:{...M.coords},timestamp:M.timestamp}:null}]);return}m({lat:t.lat,lng:t.lng})}},rt=t=>{Oe({position:[t.latitude,t.longitude],data:t}),m(null)},nt=t=>{const f=t.target.files[0];f&&qt(f).then(({markers:R,paths:B,polygons:J})=>{De.forEach(D=>Ae(D.id)),Te.forEach(D=>Ie(D.id)),Pe.forEach(D=>Ce(D.id)),R.forEach(D=>Oe(D)),B.forEach(D=>ye(D)),J&&J.forEach(D=>we(D)),alert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯!")})},st=De.filter(t=>{var J,D,oe;const f=F.markerTypes.length===0||F.markerTypes.includes((J=t.data)==null?void 0:J.type),R=F.transportModes.length===0||((D=t.data)==null?void 0:D.transportModes)&&t.data.transportModes.some(Q=>F.transportModes.includes(Q)),B=F.gender.length===0||F.gender.includes((oe=t.data)==null?void 0:oe.gender);return f&&R&&B}),ot=Te.filter(t=>F.pathTypes.length===0||F.pathTypes.includes(t.type)),at=t=>{ye({...t,coordinates:X}),h(!1),re([]),te(!1)},it=t=>{switch(t){case"hiking":return"#4CAF50";case"cycling":return"#2196F3";case"driving":return"#FF9800";default:return"#9C27B0"}};return e.jsxs("div",{className:"map-container",children:[e.jsx(K,{sx:{position:"absolute",top:"10px",right:"10px",backgroundColor:"#ffffffee",padding:"10px",borderRadius:"8px",zIndex:1200,boxShadow:"0 2px 6px rgba(0,0,0,0.15)",direction:"rtl",minWidth:"180px"},children:e.jsxs(N,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx($,{id:"map-layer-label",style:{right:"0px",fontWeight:"bold"},children:"Ù†Ù‚Ø´Ù‡ Ù¾Ø§ÛŒÙ‡"}),e.jsxs(ue,{labelId:"map-layer-label",id:"map-layer-select",value:q,label:"Ù†Ù‚Ø´Ù‡ Ù¾Ø§ÛŒÙ‡",onChange:t=>n(t.target.value),children:[e.jsx(A,{value:"street",children:"Street View"}),e.jsx(A,{value:"satellite",children:"Satellite View"})]})]})}),w&&e.jsx(Ft,{onSave:he==="manual"?at:et,onClose:()=>{h(!1),he==="manual"?(re([]),te(!1)):b([]),me(null)},pathCoordinates:he==="manual"?X:d}),o&&e.jsx(Wt,{location:o,gpsMeta:M,onClose:()=>m(null),onSave:rt}),O&&e.jsx(Bt,{isOpen:O,onClose:()=>z(!1),filterOptions:F,setFilterOptions:ze}),x&&e.jsx(Vt,{selectedItem:x,onDelete:Ye,onClose:()=>P(null)}),e.jsxs(At,{center:s,zoom:k,scrollWheelZoom:!0,style:{width:"100%",height:"100%",position:"absolute",margin:0,padding:0,direction:"rtl"},children:[e.jsx(Yt,{position:s,zoom:k}),e.jsx(Qt,{onMapClick:tt}),e.jsx(Tt,{url:Be[q],attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),a&&c&&e.jsxs(e.Fragment,{children:[e.jsx(We,{center:a,radius:c,color:"blue",fillColor:"blue",fillOpacity:.1,weight:2}),e.jsx(We,{center:a,radius:5,color:"blue",fillColor:"blue",fillOpacity:1,weight:0})]}),d.length>0&&e.jsx(be,{positions:d,color:"blue",weight:5,opacity:S?.7:1}),T&&X.length>0&&e.jsx(be,{positions:X.map(t=>t.coordinates),color:"blue",weight:5,opacity:.7}),ne&&Z.length>1&&e.jsx(Fe,{positions:Z,pathOptions:{color:"purple",fillOpacity:.2}}),Pe.map(t=>e.jsx(Fe,{positions:t.coordinates,pathOptions:{color:"purple",fillOpacity:.2},eventHandlers:{click:f=>{f.originalEvent&&f.originalEvent.stopPropagation&&f.originalEvent.stopPropagation(),fe.current=!0,P({type:"polygon",item:t})}}},t.id)),Me&&e.jsx(Jt,{onSave:qe,onClose:()=>je(!1),polygonCoordinates:Z}),st.map(t=>e.jsx(It,{position:t.position,icon:Zt,eventHandlers:{click:()=>Ze(t)}},t.id)),ot.map(t=>(Array.isArray(t.coordinates)&&typeof t.coordinates[0]=="object"&&Array.isArray(t.coordinates[0].coordinates)?t.coordinates.map(f=>f.coordinates):Array.isArray(t.coordinates[0])&&t.coordinates,e.jsx(Re.Fragment,{children:e.jsx(be,{positions:Array.isArray(t.coordinates)&&t.coordinates.length>0?typeof t.coordinates[0]=="object"&&Array.isArray(t.coordinates[0].coordinates)?t.coordinates.map(f=>f.coordinates):t.coordinates:[],color:it(t.type),weight:5,opacity:.7,eventHandlers:{click:()=>Qe(t)},children:e.jsx(Et,{children:e.jsxs("div",{children:[e.jsx("strong",{children:t.name}),e.jsx("p",{children:t.description}),e.jsxs("p",{children:["Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±: ",t.type]})]})})})},t.id)))]}),e.jsx(Xt,{isTracking:S,onStartTracking:Xe,onStopTracking:ke,onAddMarker:()=>m({lat:s[0],lng:s[1]}),onExport:Ue,onImportClick:()=>document.getElementById("importInput").click(),onFilter:()=>z(!0),onStartManualPath:Ve,isDrawingPath:T,onStartPolygon:_e,isDrawingPolygon:ne}),T&&e.jsx(W,{onClick:Ge,variant:"contained",color:"success",style:{position:"fixed",bottom:70,right:20,zIndex:9999},children:"Ù¾Ø§ÛŒØ§Ù† Ù…Ø³ÛŒØ± Ùˆ Ø°Ø®ÛŒØ±Ù‡"}),ne&&Z.length>=3&&e.jsx(W,{onClick:Ke,variant:"contained",color:"success",style:{position:"fixed",bottom:70,right:90,zIndex:9999},children:"Ù¾Ø§ÛŒØ§Ù† Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡"}),e.jsx("input",{id:"importInput",type:"file",accept:".json",onChange:nt,style:{display:"none"}})]})};$t.createRoot(document.getElementById("root")).render(e.jsx(Re.StrictMode,{children:e.jsx(er,{})}));
