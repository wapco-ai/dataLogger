import{r as a,c as zt,j as e,D as De,a as Ae,b as Ie,T as ie,F as K,I as Q,S as Oe,M as $,d as ke,e as T,C as q,R as $e,f as ne,g as Re,B as U,h as D,i as O,P as be,k as Nt,l as at,m as F,n as $t,A as Ut,o as Bt,L as le,E as Ue,W as Jt,p as N,q as it,s as lt,t as Gt,u as Vt,v as ct,w as dt,x as Se,y as Ne,G as Ht,z as _t,H as Be,J as Je,K as qt,N as Zt,O as ut,Q as Kt,U as Qt,V as Xt,X as Yt,Y as en,Z as tn,_ as nn,$ as rn,a0 as Me,a1 as on,a2 as Ce,a3 as sn,a4 as tt,a5 as an,a6 as ln,a7 as cn,a8 as dn,a9 as un,aa as nt,ab as rt,ac as Pe,ad as pt,ae as ht,af as ot,ag as pn,ah as hn,ai as gn,aj as xn,ak as ze,al as mn}from"./vendor-D85c_MhJ.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function h(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(o){if(o.ep)return;o.ep=!0;const n=h(o);fetch(o.href,n)}})();function fn(){const t=a.useRef(null),[r,h]=a.useState(!1);a.useEffect(()=>{let o=!0;return"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(n=>{n.addEventListener("updatefound",()=>{const d=n.installing;d.addEventListener("statechange",()=>{d.state==="installed"&&navigator.serviceWorker.controller&&(t.current=d,o&&h(!0))})})}),()=>{o=!1}},[]);const l=()=>{t.current&&t.current.postMessage({type:"SKIP_WAITING"})};return a.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()})},[]),{hasUpdate:r,updateApp:l}}const jn=zt({palette:{primary:{main:"#1976D2"},secondary:{main:"#9C27B0"},success:{main:"#4CAF50"},error:{main:"#E53935"},warning:{main:"#FFC107"},info:{main:"#2196F3"},background:{default:"#f5f5f5",paper:"#fff"}},typography:{fontFamily:'"Roboto","Helvetica","Arial",sans-serif',h6:{fontWeight:600},button:{textTransform:"none",fontWeight:500}},components:{MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"8px 16px"}}},MuiDialog:{styleOverrides:{paper:{borderRadius:12,padding:"16px"}}}}});function yn({location:t,gpsMeta:r,onClose:h,onSave:l}){const[o,n]=a.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[d,p]=a.useState(""),g=(u,c)=>{n(j=>({...j,[u]:c}))},y=u=>{n(c=>({...c,transportModes:{...c.transportModes,[u]:!c.transportModes[u]}}))},f=()=>{if(!o.name.trim()){p("نام گره را وارد کنید");return}const u=Object.keys(o.transportModes).filter(c=>o.transportModes[c]);l({...o,latitude:t.lat,longitude:t.lng,timestamp:new Date().toISOString(),transportModes:u,gpsMeta:r?{coords:{latitude:r.coords.latitude,longitude:r.coords.longitude,accuracy:r.coords.accuracy,altitude:r.coords.altitude,speed:r.coords.speed,heading:r.coords.heading},timestamp:r.timestamp}:null}),h()};return e.jsxs(De,{open:!0,onClose:h,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(Ae,{sx:{textAlign:"center",fontWeight:"bold"},children:"ایجاد گره جدید"}),e.jsxs(Ie,{dividers:!0,sx:{direction:"rtl"},children:[d&&e.jsx("div",{style:{color:"red",marginBottom:"16px",textAlign:"center"},children:d}),e.jsx(ie,{label:"نام گره",fullWidth:!0,margin:"normal",value:o.name,onChange:u=>g("name",u.target.value),required:!0,sx:{direction:"rtl"}}),e.jsx(ie,{label:"توضیحات",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:o.description,onChange:u=>g("description",u.target.value),sx:{direction:"rtl"}}),e.jsxs(K,{fullWidth:!0,margin:"normal",children:[e.jsx(Q,{children:"نوع گره"}),e.jsxs(Oe,{value:o.type,onChange:u=>g("type",u.target.value),label:"نوع گره",children:[e.jsx($,{value:"checkpoint",children:"نقطه بازرسی"}),e.jsx($,{value:"landmark",children:"نشانه"}),e.jsx($,{value:"poi",children:"نقطه دلخواه"}),e.jsx($,{value:"other",children:"سایر"})]})]}),e.jsxs(K,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Q,{shrink:!0,children:"شیوه‌های حمل و نقل"}),e.jsxs(ke,{children:[e.jsx(T,{control:e.jsx(q,{checked:o.transportModes.wheelchair,onChange:()=>y("wheelchair")}),label:"ویلچر"}),e.jsx(T,{control:e.jsx(q,{checked:o.transportModes.electricVan,onChange:()=>y("electricVan")}),label:"ون برقی"}),e.jsx(T,{control:e.jsx(q,{checked:o.transportModes.walking,onChange:()=>y("walking")}),label:"پیاده‌روی"})]})]}),e.jsxs(K,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Q,{shrink:!0,children:"جنسیت تردد"}),e.jsxs($e,{value:o.gender,onChange:u=>g("gender",u.target.value),children:[e.jsx(T,{value:"male",control:e.jsx(ne,{}),label:"مردانه"}),e.jsx(T,{value:"female",control:e.jsx(ne,{}),label:"زنانه"}),e.jsx(T,{value:"family",control:e.jsx(ne,{}),label:"خانوادگی"})]})]})]}),e.jsxs(Re,{children:[e.jsx(U,{onClick:h,color:"secondary",children:"انصراف"}),e.jsx(U,{onClick:f,color:"primary",variant:"contained",children:"ذخیره"})]})]})}function bn({onSave:t,onClose:r,pathCoordinates:h}){const[l,o]=a.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[n,d]=a.useState(""),p=(f,u)=>{o(c=>({...c,[f]:u}))},g=f=>{o(u=>({...u,transportModes:{...u.transportModes,[f]:!u.transportModes[f]}}))},y=()=>{if(!l.name.trim()){d("نام مسیر را وارد کنید");return}const f=Object.keys(l.transportModes).filter(u=>l.transportModes[u]);t({...l,transportModes:f,coordinates:h,timestamp:new Date().toISOString()}),r()};return e.jsxs(De,{open:!0,onClose:r,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(Ae,{sx:{textAlign:"center",fontWeight:"bold"},children:"ایجاد مسیر جدید"}),e.jsxs(Ie,{dividers:!0,children:[n&&e.jsx("div",{style:{color:"red",marginBottom:"16px",textAlign:"center"},children:n}),e.jsx(ie,{label:"نام مسیر",fullWidth:!0,margin:"normal",value:l.name,onChange:f=>p("name",f.target.value),required:!0}),e.jsx(ie,{label:"توضیحات",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:l.description,onChange:f=>p("description",f.target.value)}),e.jsxs(K,{fullWidth:!0,margin:"normal",children:[e.jsx(Q,{children:"نوع مسیر"}),e.jsxs(Oe,{value:l.type,onChange:f=>p("type",f.target.value),label:"نوع مسیر",children:[e.jsx($,{value:"hiking",children:"پیاده‌روی"}),e.jsx($,{value:"driving",children:"رانندگی"}),e.jsx($,{value:"other",children:"سایر"})]})]}),e.jsxs(K,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Q,{shrink:!0,children:"شیوه‌های حمل و نقل"}),e.jsxs(ke,{children:[e.jsx(T,{control:e.jsx(q,{checked:l.transportModes.wheelchair,onChange:()=>g("wheelchair")}),label:"ویلچر"}),e.jsx(T,{control:e.jsx(q,{checked:l.transportModes.electricVan,onChange:()=>g("electricVan")}),label:"ون برقی"}),e.jsx(T,{control:e.jsx(q,{checked:l.transportModes.walking,onChange:()=>g("walking")}),label:"پیاده‌روی"})]})]}),e.jsxs(K,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Q,{shrink:!0,children:"جنسیت تردد"}),e.jsxs($e,{value:l.gender,onChange:f=>p("gender",f.target.value),children:[e.jsx(T,{value:"male",control:e.jsx(ne,{}),label:"مردانه"}),e.jsx(T,{value:"female",control:e.jsx(ne,{}),label:"زنانه"}),e.jsx(T,{value:"family",control:e.jsx(ne,{}),label:"خانوادگی"})]})]})]}),e.jsxs(Re,{children:[e.jsx(U,{onClick:r,color:"secondary",children:"انصراف"}),e.jsx(U,{onClick:y,color:"primary",variant:"contained",children:"ذخیره"})]})]})}const Sn=[{key:"saturday",label:"شنبه"},{key:"sunday",label:"یک‌شنبه"},{key:"monday",label:"دوشنبه"},{key:"tuesday",label:"سه‌شنبه"},{key:"wednesday",label:"چهارشنبه"},{key:"thursday",label:"پنج‌شنبه"},{key:"friday",label:"جمعه"}];function kn({onSave:t,onClose:r,polygonCoordinates:h}){const[l,o]=a.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[n,d]=a.useState(""),[p,g]=a.useState({}),y=(c,j)=>o(b=>({...b,[c]:j})),f=c=>o(j=>({...j,transportModes:{...j.transportModes,[c]:!j.transportModes[c]}})),u=()=>{if(!l.name.trim()){d("نام محدوده را وارد کنید");return}const c=Object.keys(l.transportModes).filter(j=>l.transportModes[j]);t({...l,transportModes:c,coordinates:h,restrictedTimes:p,timestamp:new Date().toISOString()}),r()};return e.jsxs(De,{open:!0,onClose:r,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(Ae,{sx:{textAlign:"center",fontWeight:"bold"},children:"ایجاد محدوده جدید"}),e.jsxs(Ie,{dividers:!0,children:[n&&e.jsx("div",{style:{color:"red",marginBottom:16,textAlign:"center"},children:n}),e.jsx(ie,{label:"نام محدوده",fullWidth:!0,margin:"normal",value:l.name,onChange:c=>y("name",c.target.value),required:!0}),e.jsx(ie,{label:"توضیحات",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:l.description,onChange:c=>y("description",c.target.value)}),e.jsxs(K,{fullWidth:!0,margin:"normal",children:[e.jsx(Q,{children:"نوع محدوده"}),e.jsxs(Oe,{value:l.type,onChange:c=>y("type",c.target.value),label:"نوع محدوده",children:[e.jsx($,{value:"park",children:"پارک"}),e.jsx($,{value:"zone",children:"محدوده"}),e.jsx($,{value:"other",children:"سایر"})]})]}),e.jsxs(K,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Q,{shrink:!0,children:"شیوه‌های حمل و نقل"}),e.jsxs(ke,{children:[e.jsx(T,{control:e.jsx(q,{checked:l.transportModes.wheelchair,onChange:()=>f("wheelchair")}),label:"ویلچر"}),e.jsx(T,{control:e.jsx(q,{checked:l.transportModes.electricVan,onChange:()=>f("electricVan")}),label:"ون برقی"}),e.jsx(T,{control:e.jsx(q,{checked:l.transportModes.walking,onChange:()=>f("walking")}),label:"پیاده‌روی"})]})]}),e.jsxs(K,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Q,{shrink:!0,children:"جنسیت تردد"}),e.jsxs($e,{value:l.gender,onChange:c=>y("gender",c.target.value),children:[e.jsx(T,{value:"male",control:e.jsx(ne,{}),label:"مردانه"}),e.jsx(T,{value:"female",control:e.jsx(ne,{}),label:"زنانه"}),e.jsx(T,{value:"family",control:e.jsx(ne,{}),label:"خانوادگی"})]})]}),e.jsx(D,{variant:"subtitle1",sx:{fontWeight:"bold",mt:2,mb:1},children:e.jsx("span",{style:{borderBottom:"2px solid #999",paddingBottom:3},children:"زمان‌های محدودیت دسترسی"})}),e.jsx(O,{children:Sn.map(c=>e.jsxs(be,{elevation:p[c.key]?2:0,sx:{mb:1,borderRadius:3,p:1,bgcolor:p[c.key]?"#f5f5f5":"transparent",transition:"background .2s"},children:[e.jsx(O,{display:"flex",alignItems:"center",children:e.jsx(T,{control:e.jsx(Nt,{checked:!!p[c.key],color:"primary",onChange:j=>{g(b=>j.target.checked?{...b,[c.key]:[{start:"",end:""}]}:Object.fromEntries(Object.entries(b).filter(([S])=>S!==c.key)))}}),label:e.jsx(D,{sx:{fontWeight:"bold"},children:c.label}),labelPlacement:"start",sx:{flex:1,mr:1}})}),e.jsx(at,{in:!!p[c.key],children:e.jsxs(O,{mt:1,pl:2,pr:1,children:[(p[c.key]||[]).map((j,b)=>e.jsxs(O,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(ie,{size:"small",label:"از",type:"time",value:j.start,onChange:S=>{const C=S.target.value;g(x=>({...x,[c.key]:x[c.key].map((m,v)=>v===b?{...m,start:C}:m)}))},variant:"outlined",sx:{width:105,mx:.5,direction:"ltr",bgcolor:"#fff"},InputLabelProps:{shrink:!0,sx:{right:0,fontWeight:"bold"}},inputProps:{step:300,dir:"ltr",style:{textAlign:"center"}}}),e.jsx(D,{variant:"body2",sx:{mx:1},children:"تا"}),e.jsx(ie,{size:"small",label:"تا",type:"time",value:j.end,onChange:S=>{const C=S.target.value;g(x=>({...x,[c.key]:x[c.key].map((m,v)=>v===b?{...m,end:C}:m)}))},variant:"outlined",sx:{width:105,mx:.5,direction:"ltr",bgcolor:"#fff"},InputLabelProps:{shrink:!0,sx:{right:0,fontWeight:"bold"}},inputProps:{step:300,dir:"ltr",style:{textAlign:"center"}}}),e.jsx(F,{onClick:()=>g(S=>({...S,[c.key]:S[c.key].filter((C,x)=>x!==b)})),size:"small",color:"error",sx:{mx:.5},disabled:p[c.key].length===1,children:e.jsx($t,{fontSize:"small"})})]},b)),e.jsx(U,{onClick:()=>g(j=>({...j,[c.key]:[...j[c.key],{start:"",end:""}]})),color:"primary",size:"small",startIcon:e.jsx(Ut,{}),sx:{mt:1,fontWeight:"bold"},children:"افزودن بازه"})]})})]},c.key))})]}),e.jsxs(Re,{children:[e.jsx(U,{onClick:r,color:"secondary",children:"انصراف"}),e.jsx(U,{onClick:u,color:"primary",variant:"contained",children:"ذخیره"})]})]})}const vn=[{value:"checkpoint",label:"نقطه بازرسی"},{value:"landmark",label:"نشانه"},{value:"poi",label:"نقطه دلخواه"},{value:"other",label:"سایر"}],wn=[{value:"hiking",label:"پیاده‌روی"},{value:"driving",label:"رانندگی"},{value:"other",label:"سایر"}];function Mn({isOpen:t,onClose:r,filterOptions:h,setFilterOptions:l}){const o=(n,d)=>{l(p=>{const g=p[n]||[];return{...p,[n]:g.includes(d)?g.filter(y=>y!==d):[...g,d]}})};return e.jsxs(De,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,dir:"rtl",children:[e.jsx(Ae,{sx:{fontWeight:"bold",textAlign:"center"},children:"فیلترسازی"}),e.jsxs(Ie,{children:[e.jsxs(O,{sx:{mb:2},children:[e.jsx(D,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"نوع نشانگر"}),e.jsx(ke,{children:vn.map(n=>e.jsx(T,{control:e.jsx(q,{checked:h.markerTypes.includes(n.value),onChange:()=>o("markerTypes",n.value)}),label:n.label},n.value))})]}),e.jsx(Bt,{sx:{my:1}}),e.jsxs(O,{children:[e.jsx(D,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"نوع مسیر"}),e.jsx(ke,{children:wn.map(n=>e.jsx(T,{control:e.jsx(q,{checked:h.pathTypes.includes(n.value),onChange:()=>o("pathTypes",n.value)}),label:n.label},n.value))})]})]}),e.jsx(Re,{children:e.jsx(U,{onClick:r,color:"primary",fullWidth:!0,variant:"contained",sx:{fontWeight:"bold",borderRadius:2},children:"بستن"})})]})}const Cn=({selectedItem:t,onDelete:r,onClose:h})=>{var d,p,g,y,f,u,c,j,b,S,C;const l=x=>!x||x.length===0?"ندارد":x.map(m=>{switch(m){case"wheelchair":return"ویلچر";case"electricVan":return"ون برقی";case"walking":return"پیاده‌روی";default:return m}}).join(", "),o=x=>Array.isArray(x)?Array.isArray(x[0])?x:x.map(m=>m.coordinates||[]):[],n=x=>{const m=o(x);if(m.length<2)return 0;let v=0;for(let I=1;I<m.length;I++){const[M,R]=m[I-1],[i,k]=m[I];v+=L.latLng(M,R).distanceTo(L.latLng(i,k))}return(v/1e3).toFixed(2)};return e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",borderRadius:"10px",boxShadow:"0 4px 15px rgba(0,0,0,0.2)",width:"90%",maxWidth:"400px",maxHeight:"80vh",overflowY:"auto",zIndex:1e3},children:[e.jsxs("h2",{style:{marginBottom:"15px",textAlign:"center",color:"#333"},children:["جزئیات ",t.type==="marker"?"نشانگر":t.type==="path"?"مسیر":t.type==="polygon"?"محدوده":""]}),e.jsxs("div",{style:{backgroundColor:"#f4f4f4",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نام:"})," ",((d=t.item.data)==null?void 0:d.name)||t.item.name||"بدون نام"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"توضیحات:"})," ",((p=t.item.data)==null?void 0:p.description)||t.item.description||"بدون توضیحات"]})]}),t.type==="marker"&&e.jsxs("div",{style:{backgroundColor:"#e9f5e9",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نوع نشانگر:"})," ",((g=t.item.data)==null?void 0:g.type)||"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"شیوه‌های حمل و نقل:"})," ",l((y=t.item.data)==null?void 0:y.transportModes)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"جنسیت تردد:"}),((f=t.item.data)==null?void 0:f.gender)==="male"?"مردانه":((u=t.item.data)==null?void 0:u.gender)==="female"?"زنانه":((c=t.item.data)==null?void 0:c.gender)==="family"?"خانوادگی":"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"موقعیت مکانی:"}),`${t.item.position[0].toFixed(4)}, ${t.item.position[1].toFixed(4)}`]})]}),t.type==="path"&&e.jsxs("div",{style:{backgroundColor:"#e6f2ff",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نوع مسیر:"})," ",t.item.type||"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"طول مسیر:"})," ",n(t.item.coordinates)," کیلومتر"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تعداد نقاط مسیر:"})," ",((j=t.item.coordinates)==null?void 0:j.length)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تاریخ ایجاد:"})," ",new Date(t.item.timestamp).toLocaleDateString("fa-IR")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"دقت GPS:"}),(S=(b=t.item.gpsMeta)==null?void 0:b.coords)!=null&&S.accuracy?`${t.item.gpsMeta.coords.accuracy} متر`:"اطلاعات موجود نیست"]})]}),t.type==="polygon"&&e.jsxs("div",{style:{backgroundColor:"#f5f4e6",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نام محدوده:"})," ",t.item.name||"بدون نام"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"توضیحات:"})," ",t.item.description||"بدون توضیحات"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"نوع محدوده:"})," ",t.item.type||"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"شیوه‌های حمل و نقل:"})," ",(t.item.transportModes||[]).join(", ")||"ندارد"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"جنسیت تردد:"})," ",t.item.gender==="male"?"مردانه":t.item.gender==="female"?"زنانه":t.item.gender==="family"?"خانوادگی":"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تعداد نقاط:"})," ",((C=t.item.coordinates)==null?void 0:C.length)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تاریخ ایجاد:"})," ",new Date(t.item.timestamp).toLocaleDateString("fa-IR")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"زمان‌های محدودیت:"}),e.jsx("br",{}),t.item.restrictedTimes&&Object.keys(t.item.restrictedTimes).length>0?e.jsx("ul",{style:{margin:0,paddingRight:18},children:Object.entries(t.item.restrictedTimes).map(([x,m])=>e.jsxs("li",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:{saturday:"شنبه",sunday:"یک‌شنبه",monday:"دوشنبه",tuesday:"سه‌شنبه",wednesday:"چهارشنبه",thursday:"پنج‌شنبه",friday:"جمعه"}[x]}),":"," ",m.map((v,I)=>e.jsxs("span",{children:[v.start," - ",v.end,I<m.length-1?" ، ":""]},I))]},x))}):"محدودیتی ثبت نشده است"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"15px"},children:[e.jsxs("button",{onClick:r,style:{backgroundColor:"#dc3545",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{children:"🗑️"})," بله، حذف شود"]}),e.jsxs("button",{onClick:h,style:{backgroundColor:"#6c757d",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{children:"✖"})," انصراف"]})]})]})};function Pn({mapRef:t}){return a.useEffect(()=>{const r=t.current;r&&le.control.rotate&&!r._rotateControlAdded&&(le.control.rotate({position:"topright"}).addTo(r),r._rotateControlAdded=!0)},[t]),null}const Dn=()=>{const[t,r]=a.useState(()=>{const n=localStorage.getItem("mapMarkers");return n?JSON.parse(n):[]});return a.useEffect(()=>{localStorage.setItem("mapMarkers",JSON.stringify(t))},[t]),{markers:t,addMarker:n=>{r(d=>[...d,{...n,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removeMarker:n=>{r(d=>d.filter(p=>p.id!==n))},updateMarker:(n,d)=>{r(p=>p.map(g=>g.id===n?{...g,...d}:g))}}},An=()=>{const[t,r]=a.useState(()=>{const n=localStorage.getItem("mapPaths");return n?JSON.parse(n):[]});return a.useEffect(()=>{localStorage.setItem("mapPaths",JSON.stringify(t))},[t]),{paths:t,addPath:n=>{r(d=>[...d,{...n,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removePath:n=>{r(d=>d.filter(p=>p.id!==n))},updatePath:(n,d)=>{r(p=>p.map(g=>g.id===n?{...g,...d}:g))}}},In=()=>{const[t,r]=a.useState(()=>{const n=localStorage.getItem("mapPolygons");return n?JSON.parse(n):[]});return a.useEffect(()=>{localStorage.setItem("mapPolygons",JSON.stringify(t))},[t]),{polygons:t,addPolygon:n=>{r(d=>[...d,{...n,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removePolygon:n=>{r(d=>d.filter(p=>p.id!==n))},updatePolygon:(n,d)=>{r(p=>p.map(g=>g.id===n?{...g,...d}:g))}}},On=(t="geojson")=>{const r=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),h=JSON.parse(localStorage.getItem("mapPaths")||"[]"),l=JSON.parse(localStorage.getItem("mapPolygons")||"[]");let o,n,d;function p(c){return Array.isArray(c)?c.join(","):typeof c=="object"&&c!==null?Object.entries(c).filter(([j,b])=>b).map(([j])=>j).join(","):""}switch(t){case"geojson":const c={type:"FeatureCollection",features:[...r.map(i=>{var k,P;return{type:"Feature",geometry:{type:"Point",coordinates:[i.position[1],i.position[0]]},properties:{...i.data||{},transportModes:((k=i.data)==null?void 0:k.transportModes)||[],gender:((P=i.data)==null?void 0:P.gender)||""}}}),...h.map(i=>({type:"Feature",geometry:{type:"LineString",coordinates:Array.isArray(i.coordinates)?typeof i.coordinates[0]=="object"&&Array.isArray(i.coordinates[0].coordinates)?i.coordinates.map(k=>[k.coordinates[1],k.coordinates[0]]):i.coordinates.map(k=>[k[1],k[0]]):[]},properties:{name:i.name,description:i.description,type:i.type,timestamp:i.timestamp,transportModes:i.transportModes||[],gender:i.gender||""}})),...l.map(i=>({type:"Feature",geometry:{type:"Polygon",coordinates:[i.coordinates.map(k=>[k[1],k[0]])]},properties:{name:i.name,description:i.description,type:i.type,timestamp:i.timestamp,transportModes:i.transportModes||[],gender:i.gender||"",restrictedTimes:i.restrictedTimes||{}}}))]};o=JSON.stringify(c,null,2),n="application/geo+json",d="geojson";break;case"kml":const j=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
<Document>
`,b=`</Document>
</kml>`,S=r.map(i=>{const k=i.data||{},P=p(k.transportModes);return`
      <Placemark>
        <name>${k.name||""}</name>
        <description>${k.description||""}</description>
        <ExtendedData>
          <Data name="type"><value>${k.type||""}</value></Data>
          <Data name="transportModes"><value>${P}</value></Data>
          <Data name="gender"><value>${k.gender||""}</value></Data>
        </ExtendedData>
        <Point>
          <coordinates>${i.position[1]},${i.position[0]},0</coordinates>
        </Point>
      </Placemark>
      `}).join(""),C=h.map(i=>{const P=(Array.isArray(i.coordinates)?typeof i.coordinates[0]=="object"&&Array.isArray(i.coordinates[0].coordinates)?i.coordinates.map(A=>A.coordinates):i.coordinates:[]).map(A=>`${A[1]},${A[0]},0`).join(" "),z=p(i.transportModes);return`
      <Placemark>
        <name>${i.name||""}</name>
        <description>${i.description||""}</description>
        <ExtendedData>
          <Data name="type"><value>${i.type||""}</value></Data>
          <Data name="transportModes"><value>${z}</value></Data>
          <Data name="gender"><value>${i.gender||""}</value></Data>
        </ExtendedData>
        <LineString>
          <coordinates>
            ${P}
          </coordinates>
        </LineString>
      </Placemark>
      `}).join(""),x=l.map(i=>{const k=p(i.transportModes);let P=Array.isArray(i.coordinates)?i.coordinates.slice():[];P.length&&(P[0][0]!==P[P.length-1][0]||P[0][1]!==P[P.length-1][1])&&P.push(P[0]);const z=P.map(A=>`${A[1]},${A[0]},0`).join(" ");return`
    <Placemark>
      <name>${i.name||""}</name>
      <description>${i.description||""}</description>
      <ExtendedData>
        <Data name="type"><value>${i.type||""}</value></Data>
        <Data name="transportModes"><value>${k}</value></Data>
        <Data name="gender"><value>${i.gender||""}</value></Data>
        <Data name="restrictedTimes"><value>${i.restrictedTimes?JSON.stringify(i.restrictedTimes):""}</value></Data>
      </ExtendedData>
      <Polygon>
        <outerBoundaryIs>
          <LinearRing>
            <coordinates>
              ${z}
            </coordinates>
          </LinearRing>
        </outerBoundaryIs>
      </Polygon>
    </Placemark>
  `}).join("");o=j+S+C+x+b,n="application/vnd.google-earth.kml+xml",d="kml";break;case"csv":const m=`Type,Name,Description,PathType,TransportModes,Gender,Latitude,Longitude,Timestamp
`,v=r.map(i=>{const k=i.data||{};return["Point",`"${k.name||""}"`,`"${k.description||""}"`,"",`"${p(k.transportModes)}"`,`"${k.gender||""}"`,i.position[0],i.position[1],`"${i.timestamp}"`].join(",")}).join(`
`),I=h.map(i=>{const k=Array.isArray(i.coordinates)?typeof i.coordinates[0]=="object"&&Array.isArray(i.coordinates[0].coordinates)?i.coordinates.map(A=>A.coordinates):i.coordinates:[],[P,z]=k[0]||["",""];return["Line",`"${i.name||""}"`,`"${i.description||""}"`,`"${i.type||""}"`,`"${p(i.transportModes)}"`,`"${i.gender||""}"`,P,z,`"${i.timestamp}"`].join(",")}).join(`
`),M=l.map(i=>{const k=Array.isArray(i.coordinates)?i.coordinates:[],[P,z]=k[0]||["",""];return["Polygon",`"${i.name||""}"`,`"${i.description||""}"`,`"${i.type||""}"`,`"${p(i.transportModes)}"`,`"${i.gender||""}"`,`"${i.restrictedTimes?JSON.stringify(i.restrictedTimes):""}"`,P,z,`"${i.timestamp||""}"`].join(",")}).join(`
`);o=m+v+(v&&(I||M)?`
`:"")+I+(I&&M?`
`:"")+M,n="text/csv",d="csv";break;default:const R={version:"1.0",exportDate:new Date().toISOString(),markers:r,paths:h};o=JSON.stringify(R,null,2),n="application/json",d="json"}const g=new Blob([o],{type:n}),y=URL.createObjectURL(g),f=`map_export_${new Date().toISOString().replace(/[:.]/g,"-")}.${d}`,u=document.createElement("a");u.href=y,u.download=f,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(y)},Rn=t=>new Promise((r,h)=>{const l=new FileReader;l.onload=o=>{let n;try{n=JSON.parse(o.target.result)}catch{return h(new Error("Invalid JSON"))}if(n.version&&n.markers&&n.paths){const d=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),p=JSON.parse(localStorage.getItem("mapPaths")||"[]"),g=JSON.parse(localStorage.getItem("mapPolygons")||"[]"),y=n.markers.map(S=>({...S,id:crypto.randomUUID()})),f=n.paths.map(S=>({...S,id:crypto.randomUUID()})),u=Array.isArray(n.polygons)?n.polygons.map(S=>({...S,id:crypto.randomUUID()})):[],c=d.concat(y),j=p.concat(f),b=g.concat(u);return localStorage.setItem("mapMarkers",JSON.stringify(c)),localStorage.setItem("mapPaths",JSON.stringify(j)),localStorage.setItem("mapPolygons",JSON.stringify(b)),r({markers:c,paths:j,polygons:b})}if(n.type==="FeatureCollection"&&Array.isArray(n.features)){const d=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),p=JSON.parse(localStorage.getItem("mapPaths")||"[]"),g=JSON.parse(localStorage.getItem("mapPolygons")||"[]"),y=[],f=[],u=[];n.features.forEach(S=>{const{geometry:C,properties:x={}}=S;if(C){if(C.type==="Point"){const[m,v]=C.coordinates;y.push({id:crypto.randomUUID(),position:[v,m],data:x,timestamp:x.timestamp||new Date().toISOString()})}else if(C.type==="LineString"){const m=C.coordinates.map(([v,I])=>[I,v]);f.push({id:crypto.randomUUID(),name:x.name||"",description:x.description||"",type:x.type||"",coordinates:m,timestamp:x.timestamp||new Date().toISOString()})}else if(C.type==="Polygon"){const m=C.coordinates[0].map(([v,I])=>[I,v]);u.push({id:crypto.randomUUID(),name:x.name||"",description:x.description||"",type:x.type||"",transportModes:x.transportModes||[],gender:x.gender||"",coordinates:m,timestamp:x.timestamp||new Date().toISOString()})}}});const c=d.concat(y),j=p.concat(f),b=g.concat(u);return localStorage.setItem("mapMarkers",JSON.stringify(c)),localStorage.setItem("mapPaths",JSON.stringify(j)),localStorage.setItem("mapPolygons",JSON.stringify(b)),r({markers:c,paths:j,polygons:b})}h(new Error("Invalid import file format"))},l.onerror=()=>h(new Error("File read error")),l.readAsText(t)});function En({latitude:t,longitude:r},h,l){const n=h*Math.PI/180,d=t+l*Math.cos(n)/6378137*(180/Math.PI),p=r+l*Math.sin(n)/(6378137*Math.cos(t*Math.PI/180))*(180/Math.PI);return{latitude:d,longitude:p}}function Ln(){const[t,r]=a.useState(!1),[h,l]=a.useState([]),o=a.useRef(null),n=a.useRef(null),d=a.useRef(null),p=a.useRef(0);return a.useEffect(()=>{const f=u=>{typeof u.alpha=="number"&&(p.current=u.alpha)};return window.addEventListener("deviceorientation",f,!0),()=>window.removeEventListener("deviceorientation",f,!0)},[]),a.useEffect(()=>{if(!t)return;const f=navigator.geolocation.watchPosition(u=>{const{latitude:c,longitude:j,accuracy:b,speed:S,heading:C}=u.coords,x=u.timestamp;n.current={latitude:c,longitude:j,timestamp:x};let m=o.current;if(!m)m={latitude:c,longitude:j,timestamp:x};else if(d.current){const v=(x-d.current)/1e3,M=(typeof S=="number"&&S>0?S:1)*v,R=(360-p.current)%360;m=En(m,R,-M),console.log("DR in:",m,typeof m.latitude,typeof m.longitude)}o.current=m,d.current=x,l(v=>[...v,{gps:{latitude:c,longitude:j,accuracy:b,speed:S,heading:C,timestamp:x},dr:{latitude:m.latitude,longitude:m.longitude,timestamp:x}}])},u=>{},{enableHighAccuracy:!0,maximumAge:0,timeout:15e3});return()=>{navigator.geolocation.clearWatch(f),o.current=null,n.current=null,d.current=null}},[t]),{tracking:t,points:h,start:()=>{l([]),r(!0),o.current=null,n.current=null,d.current=null,navigator.geolocation.getCurrentPosition(f=>{const{latitude:u,longitude:c,accuracy:j,speed:b,heading:S}=f.coords,C=f.timestamp;n.current={latitude:u,longitude:c,timestamp:C},o.current={latitude:u,longitude:c,timestamp:C},d.current=C,l([{gps:{latitude:u,longitude:c,accuracy:j,speed:b,heading:S,timestamp:C},dr:{latitude:u,longitude:c,timestamp:C}}])},f=>console.warn("Initial GPS fetch failed:",f),{enableHighAccuracy:!0})},stop:()=>{r(!1)}}}function Tn(){const[t,r]=a.useState(!0),[h,l]=a.useState(null);return a.useEffect(()=>{let o=null,n=0;function d(p){if(!p.absolute){r(!1),l("سنسور قطب‌نما کالیبره نیست. لطفاً با حرکت ۸ انگلیسی دستگاه را کالیبره کنید.");return}if(p.alpha==null||isNaN(p.alpha)||p.alpha===0&&p.beta===0&&p.gamma===0){r(!1),l("دریافت داده معتبر از سنسور قطب‌نما ممکن نیست. ممکن است دستگاه شما نیاز به کالیبره داشته باشد.");return}if(o!==null&&Math.abs(p.alpha-o)>80){if(n++,n>2){r(!1),l("سنسور قطب‌نما مشکوک به عدم کالیبراسیون است (پرش شدید زاویه).");return}}else n=0;o=p.alpha,r(!0),l(null)}return window.addEventListener("deviceorientation",d,!0),()=>window.removeEventListener("deviceorientation",d,!0)},[]),{calibrated:t,error:h}}function Wn(){const{calibrated:t,error:r}=Tn();return e.jsx(O,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:t?"#e8f5e9":"#fff3e0",color:t?"#388e3c":"#d32f2f",fontWeight:"bold",borderRadius:2,p:1,my:1,boxShadow:"0 2px 8px rgba(0,0,0,0.08)",fontSize:"15px"},children:t?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{sx:{mr:1}}),"سنسور قطب‌نما کالیبره است"]}):e.jsxs(e.Fragment,{children:[e.jsx(Jt,{sx:{mr:1}}),r||"کالیبراسیون سنسور مورد نیاز است.",e.jsx(D,{variant:"body2",sx:{display:"inline",ml:1,fontWeight:"normal"},children:e.jsxs("span",{children:["گوشی را به شکل عدد ",e.jsx("b",{children:"۸"})," انگلیسی تکان دهید"]})})]})})}function Fn(t){if(t.length<2)return 0;const[r,h]=t[t.length-2],[l,o]=t[t.length-1],n=l-r,d=o-h;return(Math.atan2(d,n)*180/Math.PI+360)%360}function zn({position:t,heading:r}){const h=le.divIcon({className:"",iconSize:[48,48],iconAnchor:[24,24],html:`
       <div style="
         transform: rotate(${r}deg);
         width: 48px; height: 48px;
         display: flex;
         align-items: center;
         justify-content: center;
       ">
         <!-- simple arrow SVG -->
         <svg width="32" height="32" viewBox="0 0 24 24" fill="orange" xmlns="http://www.w3.org/2000/svg">
           <path d="M12 2 L19 21 L12 17 L5 21 Z"/>
         </svg>
       </div>
     `});return e.jsx(Be,{position:t,icon:h})}function st(t,r){return t.map(h=>h[r]&&h[r].latitude&&h[r].longitude?[h[r].latitude,h[r].longitude]:null).filter(Boolean)}function Nn(t){const r=`timestamp,gps_lat,gps_lng,gps_accuracy,dr_lat,dr_lng
`,h=t.map(d=>`${d.gps.timestamp},${d.gps.latitude},${d.gps.longitude},${d.gps.accuracy||""},${d.dr.latitude},${d.dr.longitude}`).join(`
`),l=new Blob([r+h],{type:"text/csv"}),o=URL.createObjectURL(l),n=document.createElement("a");n.href=o,n.download="dualtrack.csv",n.click()}function $n(t){const r={type:"Feature",properties:{source:"gps"},geometry:{type:"LineString",coordinates:t.map(p=>[p.gps.longitude,p.gps.latitude])}},h={type:"Feature",properties:{source:"deadReckoning"},geometry:{type:"LineString",coordinates:t.map(p=>[p.dr.longitude,p.dr.latitude])}},l={type:"FeatureCollection",features:[r,h]},o=new Blob([JSON.stringify(l,null,2)],{type:"application/geo+json"}),n=URL.createObjectURL(o),d=document.createElement("a");d.href=n,d.download="dualtrack.geojson",d.click()}function Un({gps:t,dr:r,mode:h}){const l=Je();return a.useEffect(()=>{h==="gps"&&t?l.setView([t.latitude,t.longitude],l.getZoom()):h==="dr"&&r&&l.setView([r.latitude,r.longitude],l.getZoom())},[t,r,h,l]),null}function Bn({mode:t,actions:r,mapHeight:h}){const{tracking:l,points:o,start:n,stop:d}=Ln(),p=()=>{n(),j("gps")},g=o.length?o[o.length-1].gps:null,y=o.length?o[o.length-1].dr:null,f=st(o,"gps"),u=st(o,"dr"),[c,j]=a.useState(t==="mapOnly"?"gps":"off"),[b,S]=a.useState(null),[C,x]=a.useState(null),m=a.useRef(null),v=a.useRef(!1),I=Fn(u);return a.useEffect(()=>{t==="full"&&!l&&m.current&&navigator.geolocation.getCurrentPosition(M=>{const R=M.coords.latitude,i=M.coords.longitude;S({latitude:R,longitude:i}),m.current.setView([R,i],17),v.current=!0},M=>{console.warn("Failed to fetch initial GPS:",M)},{enableHighAccuracy:!0})},[t,l,m.current]),a.useEffect(()=>{const M=g||b;t==="full"&&M&&!v.current&&x(M),t!=="full"&&(v.current=!1)},[t,g,b]),e.jsxs(O,{sx:{height:"100%",display:"flex",flexDirection:"column",direction:"rtl"},children:[e.jsx(O,{sx:{textAlign:"center",py:1},children:e.jsx(D,{variant:"h6",fontSize:15,children:"مسیرآزمایشی مقایسه GPS و Dead Reckoning"})}),e.jsxs(O,{sx:{display:"flex",justifyContent:"center",gap:2,pb:1},children:[e.jsx(N,{title:l?"پایان مسیر":"شروع مسیر",children:e.jsx(F,{color:l?"error":"success",onClick:l?d:p,size:"large",children:l?e.jsx(it,{}):e.jsx(lt,{})})}),e.jsx(N,{title:"خروجی CSV",children:e.jsx("span",{children:e.jsx(F,{color:"success",disabled:!o.length,onClick:()=>Nn(o),size:"large",children:e.jsx(Gt,{})})})}),e.jsx(N,{title:"خروجی GeoJSON",children:e.jsx("span",{children:e.jsx(F,{color:"info",disabled:!o.length,onClick:()=>$n(o),size:"large",children:e.jsx(Vt,{})})})})]}),e.jsx(Wn,{}),e.jsxs(O,{sx:{flex:1,minHeight:0},children:[e.jsxs(ct,{center:f.length?f[f.length-1]:[36.2972,59.6067],zoom:16,style:{height:"100%",width:"100%"},whenCreated:M=>{m.current=M,t!=="compact"&&navigator.geolocation.getCurrentPosition(R=>M.setView([R.coords.latitude,R.coords.longitude],17),R=>console.warn("Failed to fetch initial GPS:",R),{enableHighAccuracy:!0})},children:[e.jsx(dt,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(Se,{positions:f,color:"blue",weight:5,opacity:.7}),e.jsx(Se,{positions:u,color:"orange",weight:4,opacity:.7,dashArray:"6 8"}),g&&e.jsx(Ne,{center:[g.latitude,g.longitude],radius:6,color:"blue"}),y&&e.jsx(Ne,{center:[y.latitude,y.longitude],radius:6,color:"orange"}),u.length>0&&e.jsx(zn,{position:u[u.length-1],heading:I}),e.jsx(Un,{gps:g,dr:y,mode:c})]}),e.jsx(O,{sx:{position:"absolute",bottom:46,right:23,zIndex:1e3,backgroundColor:"#fff",borderRadius:"50%",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},children:e.jsx(N,{title:`دنبال‌کردن: ${c==="gps"?"GPS":c==="dr"?"DR":"خاموش"}`,children:e.jsx(F,{onClick:()=>j(M=>M==="off"?"gps":M==="gps"?"dr":"off"),color:c==="off"?"default":c==="gps"?"primary":"warning",size:"large",children:c==="gps"?e.jsx(Ht,{}):c==="dr"?e.jsx(Ue,{}):e.jsx(_t,{})})})})]}),o.length>0&&e.jsxs(O,{sx:{py:1,px:2},children:[e.jsxs(D,{variant:"subtitle2",children:["تعداد نقاط: ",o.length]}),e.jsxs(D,{variant:"body2",children:["آخرین GPS: ",g?`${g.latitude.toFixed(6)}, ${g.longitude.toFixed(6)}`:"-",e.jsx("br",{}),"آخرین Dead Reckoning: ",y?`${y.latitude.toFixed(6)}, ${y.longitude.toFixed(6)}`:"-",e.jsx("br",{}),"خطای لحظه‌ای (متر): ",g&&y?Math.sqrt(Math.pow((g.latitude-y.latitude)*111320,2)+Math.pow((g.longitude-y.longitude)*40075e3*Math.cos(g.latitude*Math.PI/180)/360,2)).toFixed(2):"-"]})]})]})}function Jn({isTracking:t,onStartTracking:r,onStopTracking:h,onAddMarker:l,onExport:o,onImportClick:n,onFilter:d,onStartManualPath:p,isDrawingPath:g,onStartPolygon:y,isDrawingPolygon:f,onPanelToggle:u}){const c=qt(),b=Zt(c.breakpoints.down("sm"))?"small":"medium",[S,C]=a.useState(null),x=A=>{C(A.currentTarget)},m=A=>{C(null),A&&typeof o=="function"&&o(A)},[v,I]=a.useState(!1),[M,R]=a.useState("closed"),i=M!=="closed",k=()=>{R(M==="full"?"compact":"full"),u&&u(!0)},P=()=>{R("closed"),u&&u(!1)},z=ut();return e.jsxs(Kt,{position:"fixed",color:"inherit",sx:{top:"auto",bottom:0},children:[e.jsxs(Qt,{sx:{justifyContent:"space-around"},children:[e.jsx(N,{title:t?"توقف ردیابی":"شروع ردیابی",arrow:!0,children:e.jsx(F,{color:t?"error":"success",onClick:t?h:r,size:b,children:t?e.jsx(it,{}):e.jsx(lt,{})})}),e.jsx(N,{title:"نشانگر",arrow:!0,children:e.jsx(F,{color:"primary",onClick:l,size:b,children:e.jsx(Xt,{})})}),e.jsx(N,{title:"مسیر دستی",arrow:!0,children:e.jsx(F,{color:g?"success":"primary",onClick:p,size:b,children:e.jsx(Yt,{})})}),e.jsx(N,{title:f?"در حال ترسیم محدوده":"محدوده جدید",arrow:!0,children:e.jsx(F,{color:f?"success":"primary",onClick:y,size:b,children:e.jsx(en,{})})}),e.jsx(N,{title:"فیلتر",arrow:!0,children:e.jsx(F,{color:"secondary",onClick:d,size:b,children:e.jsx(tn,{})})}),e.jsx(N,{title:"خروجی",arrow:!0,children:e.jsx(F,{color:"warning",onClick:x,size:b,children:e.jsx(nn,{})})}),e.jsxs(rn,{anchorEl:S,open:!!S,onClose:()=>m(),children:[e.jsxs($,{onClick:()=>m("geojson"),children:[e.jsx(Me,{children:e.jsx(on,{fontSize:"small"})}),e.jsx(Ce,{children:"GeoJSON"})]}),e.jsxs($,{onClick:()=>m("kml"),children:[e.jsx(Me,{children:e.jsx(sn,{fontSize:"small"})}),e.jsx(Ce,{children:"KML"})]}),e.jsxs($,{onClick:()=>m("csv"),children:[e.jsx(Me,{children:e.jsx(tt,{fontSize:"small"})}),e.jsx(Ce,{children:"CSV"})]}),e.jsxs($,{onClick:()=>m("json"),children:[e.jsx(Me,{children:e.jsx(tt,{fontSize:"small"})}),e.jsx(Ce,{children:"JSON"})]})]}),e.jsx(N,{title:"ورودی",arrow:!0,children:e.jsx(F,{color:"inherit",onClick:n,size:b,children:e.jsx(an,{})})}),e.jsx(N,{title:"تست مسیر GPS/DR",arrow:!0,children:e.jsx(F,{color:"info",onClick:()=>{R("full"),u&&u(!0)},size:"large",children:e.jsx(ln,{})})}),e.jsx(N,{title:"بررسی کالیبراسیون قطب‌نما",arrow:!0,children:e.jsx(F,{color:"info",onClick:()=>z("/calibration"),size:b,children:e.jsx(Ue,{})})})]}),e.jsx(cn,{direction:"up",in:i,mountOnEnter:!0,unmountOnExit:!0,children:e.jsxs(be,{elevation:20,sx:{position:"fixed",left:0,right:0,bottom:0,height:M==="full"?"100dvh":"25vh",borderTopLeftRadius:24,borderTopRightRadius:24,zIndex:2e4,bgcolor:"background.paper",boxShadow:16,display:"flex",flexDirection:"column",pt:1,pb:1},children:[e.jsxs(O,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2},children:[e.jsx(N,{title:"بستن",children:e.jsx(F,{onClick:P,children:"×"})}),e.jsx(D,{sx:{fontWeight:"bold",fontSize:"16px"},children:"تست مسیر GPS/DR"}),e.jsx(N,{title:M==="full"?"حالت کوچک":"تمام صفحه",children:e.jsx(F,{onClick:k,children:M==="full"?e.jsx(dn,{}):e.jsx(un,{})})})]}),e.jsx(O,{sx:{flex:1,minHeight:0,px:2,pb:2},children:e.jsx(Bn,{mode:M})})]})})]})}console.log(le.control.rotate);console.log(le.version);const Gn=le.divIcon({className:"center-marker-icon",html:'<div class="center-pin">📍</div>',iconSize:[20,26],iconAnchor:[10,26],popupAnchor:[0,-26]});le.divIcon({className:"custom-marker-icon",html:`
    <div style="
      width: 30px; 
      height: 30px; 
      background-color: #2196F3; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      color: white; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    ">
      📍
    </div>
  `,iconSize:[30,30],iconAnchor:[15,15]});function Vn({position:t,children:r,...h}){const l=a.useRef(null);return a.useEffect(()=>{const o=l.current;o&&(o.off("click"),o.on("click",()=>h.onClick&&h.onClick()))},[h]),e.jsxs(Be,{ref:l,position:t,...h,children:[e.jsx(pt,{children:r}),"  "]})}const Hn={checkpoint:"#e53935",landmark:"#1e88e5",poi:"#fb8c00",other:"#6d4c41"};function _n(t){const r=Hn[t]||"#757575",h=t?t[0].toUpperCase():"";return le.divIcon({className:"category-marker-icon",html:`
      <div style="
        width:30px; height:30px;
        background:${r};
        border-radius:50%;
        display:flex; align-items:center; justify-content:center;
        color:white; font-size:16px; font-weight:bold;
        box-shadow:0 2px 5px rgba(0,0,0,0.3);
      ">${h}</div>
    `,iconSize:[30,30],iconAnchor:[15,15]})}function qn({onPositionChange:t}){const r=Je();return a.useEffect(()=>{t(r.getCenter())},[]),ht({dragend:()=>t(r.getCenter()),zoomend:()=>t(r.getCenter())}),null}function Zn({onMapClick:t,manualMode:r}){return ht({click:h=>{r||t(h.latlng)}}),null}function Kn({position:t,zoom:r}){const h=Je();return a.useEffect(()=>{t&&h.setView(t,r)},[t,r]),null}const Qn=()=>{const[t,r]=a.useState([36.2972,59.6067]),[h,l]=a.useState(12),[o,n]=a.useState(null),[d,p]=a.useState(null),[g,y]=a.useState([]),[f,u]=a.useState(null),[c,j]=a.useState(null),[b,S]=a.useState(!1),[C,x]=a.useState(!1),[m,v]=a.useState(null),[I,M]=a.useState(!1),[R,i]=a.useState("street"),k=a.useRef(null),[P,z]=a.useState(null),[A,V]=a.useState(!1),[ce,de]=a.useState([]),[Ee,re]=a.useState([]),[me,fe]=a.useState(null),[E,X]=a.useState(!1),[B,H]=a.useState([]),[oe,J]=a.useState(!1),Z=a.useRef(!1),{polygons:G,addPolygon:_,removePolygon:ue}=In(),[he,pe]=a.useState(!1),[ge,gt]=a.useState(null),[je,Le]=a.useState(!1),[xe,Te]=a.useState(null),Ge=a.useRef(null),xt=(s="json")=>{On(s)},[Y,mt]=a.useState({markerTypes:[],pathTypes:[],transportModes:[],gender:[]}),ft={street:"Street View",esri:"Esri World Imagery",eox:"EOX S2 Cloudless 2020"},Ve={street:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",esri:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",eox:"https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2020_3857/default/g/{z}/{y}/{x}.jpg"},{markers:He,addMarker:_e,removeMarker:qe}=Dn(),{paths:Ze,addPath:We,removePath:Ke}=An(),ve=a.useRef(null),Qe=a.useCallback(()=>{if(u(null),!navigator.geolocation){u("موقعیت مکانی در دستگاه شما پشتیبانی نمی‌شود");return}const s={enableHighAccuracy:!0,timeout:3e4,maximumAge:0};navigator.geolocation.getCurrentPosition(w=>{const{latitude:ee,longitude:se,accuracy:te}=w.coords,W=[ee,se];n(W),z(w),p(te),r(W),l(15)},w=>{switch(w.code){case w.PERMISSION_DENIED:u("دسترسی به موقعیت مکانی رد شد");break;case w.POSITION_UNAVAILABLE:u("اطلاعات موقعیت در دسترس نیست");break;case w.TIMEOUT:u("زمان درخواست موقعیت مکانی به پایان رسید");break;default:u("خطا در دریافت موقعیت مکانی")}r([36.2972,59.6067]),l(12)},s)},[]),jt=()=>{V(!0),de([]),u(null)},yt=()=>{ce.length>1?(V(!1),fe("manual"),x(!0)):u("مسیر بسیار کوتاه است. حداقل دو نقطه نیاز است.")},bt=a.useRef(g),St=()=>{X(!0),H([])},kt=()=>{B.length>=3?(X(!1),J(!0)):alert("حداقل سه نقطه نیاز است.")},vt=s=>{_(s),J(!1),H([]),X(!1)};a.useEffect(()=>{bt.current=g},[g]);const wt=()=>{S(!0),y([]),u(null),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{y(s=>(s.length===0&&(Fe(),u("عدم موفقیت در دریافت موقعیت مکانی. لطفاً مجدداً تلاش کنید.")),s))},3e4),ve.current=navigator.geolocation.watchPosition(s=>{console.log("GPS update:",s.coords.latitude,s.coords.longitude,"accuracy:",s.coords.accuracy),z(s);const{latitude:w,longitude:ee,accuracy:se,altitude:te,speed:W,heading:we}=s.coords,ye=[w,ee];clearTimeout(k.current),se<=5e3&&(n(ye),u(null),y(ae=>{if(ae.length===0)return[...ae,ye];const Ye=ae[ae.length-1],et=1e-6;return Math.abs(Ye[0]-w)>et||Math.abs(Ye[1]-ee)>et?[...ae,ye]:ae}),re(ae=>[...ae,{coords:{latitude:w,longitude:ee,accuracy:se,altitude:te,speed:W,heading:we},timestamp:s.timestamp}]))},s=>{console.error("Tracking error:",s),clearTimeout(k.current);let w="خطا در دریافت موقعیت";switch(s.code){case s.PERMISSION_DENIED:w="دسترسی به موقعیت مکانی رد شد";break;case s.POSITION_UNAVAILABLE:w="اطلاعات موقعیت در دسترس نیست";break;case s.TIMEOUT:w="زمان درخواست موقعیت مکانی به پایان رسید";break}u(w),Fe()},{enableHighAccuracy:!0,timeout:3e4,maximumAge:0,distanceFilter:1})},Fe=()=>{ve.current&&(navigator.geolocation.clearWatch(ve.current),ve.current=null),S(!1),g.length>1?(fe("gps"),x(!0)):(y([]),u("مسیر بسیار کوتاه است. لطفاً مسافت بیشتری را طی کنید."))},Xe=s=>{v({type:"marker",item:s})},Mt=s=>{v({type:"path",item:s})},Ct=()=>{if(m){const{type:s,item:w}=m;s==="marker"?qe(w.id):s==="path"?Ke(w.id):s==="polygon"&&ue(w.id),v(null)}},Pt=s=>{We({...s,coordinates:g,pointsMeta:Ee}),x(!1),y([]),re([])};a.useEffect(()=>{Qe()},[Qe]);const Dt=()=>{Le(!0),Te(null)},At=()=>{xe?(Le(!1),j({lat:xe.lat,lng:xe.lng})):u("لطفاً جایگاه را تنظیم کنید")},It=()=>{Le(!1),Te(null)},Ot=s=>{if(!je){if(Z.current){Z.current=!1;return}if(!(m||oe||C||c)){if(E){H(w=>[...w,[s.lat,s.lng]]);return}if(A){de(w=>[...w,{coordinates:[s.lat,s.lng],gpsMeta:P?{coords:{...P.coords},timestamp:P.timestamp}:null}]);return}gt(s),j({lat:s.lat,lng:s.lng})}}},Rt=s=>{_e({position:[s.latitude,s.longitude],data:s}),j(null)},Et=s=>{const w=s.target.files[0];w&&Rn(w).then(({markers:ee,paths:se,polygons:te})=>{He.forEach(W=>qe(W.id)),Ze.forEach(W=>Ke(W.id)),G.forEach(W=>ue(W.id)),ee.forEach(W=>_e(W)),se.forEach(W=>We(W)),te&&te.forEach(W=>_(W)),alert("اطلاعات با موفقیت وارد شد!")})},Lt=He.filter(s=>{var te,W,we;const w=Y.markerTypes.length===0||Y.markerTypes.includes((te=s.data)==null?void 0:te.type),ee=Y.transportModes.length===0||((W=s.data)==null?void 0:W.transportModes)&&s.data.transportModes.some(ye=>Y.transportModes.includes(ye)),se=Y.gender.length===0||Y.gender.includes((we=s.data)==null?void 0:we.gender);return w&&ee&&se}),Tt=Ze.filter(s=>Y.pathTypes.length===0||Y.pathTypes.includes(s.type)),Wt=s=>{We({...s,coordinates:ce}),x(!1),de([]),V(!1)},Ft=s=>{switch(s){case"hiking":return"#4CAF50";case"cycling":return"#2196F3";case"driving":return"#FF9800";default:return"#9C27B0"}};return e.jsxs("div",{className:`map-container ${je?"manual-marker-mode":""}`,children:[e.jsx(O,{sx:{position:"absolute",top:"10px",right:"10px",backgroundColor:"#ffffffee",padding:"10px",borderRadius:"8px",zIndex:he?500:1200,boxShadow:"0 2px 6px rgba(0,0,0,0.15)",direction:"rtl",minWidth:"180px"},children:e.jsxs(K,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(Q,{id:"map-layer-label",style:{right:"0px",fontWeight:"bold"},children:"نقشه پایه"}),e.jsx(Oe,{labelId:"map-layer-label",id:"map-layer-select",value:R,label:"نقشه پایه",onChange:s=>i(s.target.value),children:Object.keys(Ve).map(s=>e.jsx($,{value:s,children:ft[s]||s},s))})]})}),C&&e.jsx(bn,{onSave:me==="manual"?Wt:Pt,onClose:()=>{x(!1),me==="manual"?(de([]),V(!1)):y([]),fe(null)},pathCoordinates:me==="manual"?ce:g}),c&&e.jsx(yn,{location:c,gpsMeta:P,onClose:()=>j(null),onSave:Rt}),I&&e.jsx(Mn,{isOpen:I,onClose:()=>M(!1),filterOptions:Y,setFilterOptions:mt}),m&&e.jsx(Cn,{selectedItem:m,onDelete:Ct,onClose:()=>v(null)}),e.jsxs(ct,{zoom:h,scrollWheelZoom:!0,tap:!0,style:{width:"100%",height:"100%",position:"absolute",margin:0,padding:0,direction:"rtl"},whenCreated:s=>{Ge.current=s},children:[e.jsx(Kn,{position:t,zoom:h}),e.jsx(Pn,{mapRef:Ge}),e.jsx(Zn,{onMapClick:Ot,manualMode:je}),e.jsx(dt,{url:Ve[R],maxZoom:21,attribution:'© <a href="wapco.ir">wapco</a> contributors'}),o&&d&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{center:o,radius:d,color:"#e6f2ff",fillColor:"#1976d2",fillOpacity:.1,weight:2}),e.jsx(nt,{center:o,radius:6,pathOptions:{color:"#e6f2ff",weight:2,fillColor:"#1976d2",fillOpacity:1}})]}),g.length>0&&e.jsx(Se,{positions:g,color:"blue",weight:5,opacity:b?.7:1}),A&&ce.length>0&&e.jsx(Se,{positions:ce.map(s=>s.coordinates),color:"blue",weight:5,opacity:.7}),E&&B.length>1&&e.jsx(rt,{positions:B,pathOptions:{color:"purple",fillOpacity:.2}}),G.map(s=>e.jsx(rt,{positions:s.coordinates,pathOptions:{color:"purple",fillOpacity:.2},eventHandlers:{click:w=>{w.originalEvent&&w.originalEvent.stopPropagation&&w.originalEvent.stopPropagation(),Z.current=!0,v({type:"polygon",item:s})}}},s.id)),oe&&e.jsx(kn,{onSave:vt,onClose:()=>J(!1),polygonCoordinates:B}),je&&e.jsxs(e.Fragment,{children:["  ",e.jsx(qn,{onPositionChange:Te}),xe&&e.jsx(Be,{position:[xe.lat,xe.lng],icon:Gn})," "]}),ge&&e.jsx(nt,{center:ge,radius:6,pathOptions:{color:"black",fillColor:"black",fillOpacity:1}}),Lt.map(s=>e.jsx(Vn,{position:s.position,icon:_n(s.data.type),onClick:()=>Xe(s),eventHandlers:{click:()=>Xe(s)}},s.id)),Tt.map(s=>(Array.isArray(s.coordinates)&&typeof s.coordinates[0]=="object"&&Array.isArray(s.coordinates[0].coordinates)?s.coordinates.map(w=>w.coordinates):Array.isArray(s.coordinates[0])&&s.coordinates,e.jsx(Pe.Fragment,{children:e.jsx(Se,{positions:Array.isArray(s.coordinates)&&s.coordinates.length>0?typeof s.coordinates[0]=="object"&&Array.isArray(s.coordinates[0].coordinates)?s.coordinates.map(w=>w.coordinates):s.coordinates:[],color:Ft(s.type),weight:5,opacity:.7,eventHandlers:{click:()=>Mt(s)},children:e.jsx(pt,{children:e.jsxs("div",{children:[e.jsx("strong",{children:s.name}),e.jsx("p",{children:s.description}),e.jsxs("p",{children:["نوع مسیر: ",s.type]})]})})})},s.id)))]}),e.jsx(Jn,{isTracking:b,onStartTracking:wt,onStopTracking:Fe,onAddMarker:Dt,onExport:xt,onImportClick:()=>document.getElementById("importInput").click(),onFilter:()=>M(!0),onStartManualPath:jt,isDrawingPath:A,onStartPolygon:St,isDrawingPolygon:E,onPanelToggle:pe}),je&&e.jsxs(e.Fragment,{children:[" ",e.jsx(U,{onClick:At,variant:"contained",color:"success",sx:{position:"fixed",bottom:80,right:20,zIndex:1300},children:"پایان نشانگر و ذخیره"}),e.jsx(U,{onClick:It,variant:"contained",color:"warning",sx:{position:"fixed",bottom:80,right:160,zIndex:1300},children:"لغو"})," "]}),A&&e.jsx(U,{onClick:yt,variant:"contained",color:"success",style:{position:"fixed",bottom:70,right:20,zIndex:9999},children:"پایان مسیر و ذخیره"}),E&&B.length>=3&&e.jsx(U,{onClick:kt,variant:"contained",color:"success",style:{position:"fixed",bottom:70,right:90,zIndex:9999},children:"پایان محدوده و ذخیره"}),e.jsx("input",{id:"importInput",type:"file",accept:".json",onChange:Et,style:{display:"none"}})]})};function Xn(){return e.jsx("div",{style:{textAlign:"center",marginTop:100,fontWeight:"bold",color:"red"},children:"صفحه پیدا نشد!"})}function Yn(){const[t,r]=a.useState(!1),[h,l]=a.useState("--"),[o,n]=a.useState("--"),[d,p]=a.useState("--"),[g,y]=a.useState("--"),[f,u]=a.useState("--"),[c,j]=a.useState(0),[b,S]=a.useState("--"),[C,x]=a.useState(0),[m,v]=a.useState("error"),[I,M]=a.useState("در انتظار شروع"),[R,i]=a.useState("روی دکمه شروع کلیک کنید"),[k,P]=a.useState(!1),[z,A]=a.useState(""),V=a.useRef([]),ce=a.useRef(null),de=ut(),Ee=Pe.useCallback(E=>{if(!t||E.alpha==null)return;const X=E.alpha,B=E.beta,H=E.gamma;if(V.current.push({alpha:X,beta:B,gamma:H}),l(X.toFixed(1)+"°"),n(B.toFixed(1)+"°"),p(H.toFixed(1)+"°"),y(X.toFixed(1)+"°"),j(V.current.length),V.current.length>=10){const J=V.current.slice(-50).map(pe=>pe.alpha),Z=J.reduce((pe,ge)=>pe+ge,0)/J.length,G=Math.sqrt(J.reduce((pe,ge)=>pe+Math.pow(ge-Z,2),0)/J.length);let _="ضعیف",ue=20,he="error";G<5?(_="عالی",ue=100,he="success"):G<15?(_="خوب",ue=70,he="warning"):G<30&&(_="متوسط",ue=40,he="warning"),S(_),x(ue),v(he),u("±"+G.toFixed(1)+"°")}},[t]),re=a.useRef();re.current||(re.current=E=>Ee(E));const me=async()=>{if(A(""),!window.DeviceOrientationEvent){A("سنسور جهت‌یابی پشتیبانی نمی‌شود.");return}if(typeof window.DeviceOrientationEvent.requestPermission=="function")try{if(await window.DeviceOrientationEvent.requestPermission()!=="granted"){A("دسترسی به سنسور قطب‌نما توسط کاربر رد شد.");return}}catch(E){A("خطا در درخواست دسترسی: "+E.message);return}V.current=[],l("--"),n("--"),p("--"),y("--"),u("--"),j(0),S("--"),x(0),v("error"),M("در حال نظارت"),i("گوشی را حرکت دهید..."),r(!0),ce.current=Date.now(),window.addEventListener("deviceorientation",re.current)},fe=()=>{if(r(!1),window.removeEventListener("deviceorientation",re.current),!V.current.length){M("خطا"),i("داده‌ای دریافت نشد. سنسور قطب‌نما کار نمی‌کند"),S("--"),x(0),v("error");return}const E=V.current.map(G=>G.alpha),X=E.reduce((G,_)=>G+_,0)/E.length,B=Math.sqrt(E.reduce((G,_)=>G+Math.pow(_-X,2),0)/E.length);let H="ضعیف",oe=20,J="error",Z="نیاز به کالیبراسیون — گوشی را به شکل ۸ انگلیسی حرکت دهید";B<5?(H="عالی",oe=100,J="success",Z="کالیبراسیون عالی — قطب‌نما آماده استفاده است"):B<15?(H="خوب",oe=70,J="warning",Z="کالیبراسیون خوب — مناسب برای اغلب کاربردها"):B<30&&(H="متوسط",oe=40,J="warning",Z="کالیبراسیون متوسط"),S(H),x(oe),v(J),M(H),i(Z),u("±"+B.toFixed(1)+"°")};return Pe.useEffect(()=>()=>{window.removeEventListener("deviceorientation",re.current)},[]),console.log("test update"),e.jsxs(O,{sx:{maxWidth:400,width:"100vw",minHeight:"100vh",mx:"auto",p:{xs:1,sm:2},bgcolor:"#fafbfc",borderRadius:{xs:0,sm:5},boxShadow:{xs:0,sm:6},direction:"rtl",fontFamily:"'Vazirmatn', 'Vazir', Arial, sans-serif",display:"flex",flexDirection:"column",justifyContent:"flex-start",position:"relative"},children:[e.jsx(F,{onClick:()=>de("/"),sx:{position:"absolute",top:10,left:10,zIndex:10,bgcolor:"#fff",boxShadow:1},children:e.jsx(ot,{})}),e.jsx(D,{variant:"h5",fontWeight:"bold",align:"center",color:"primary",mb:2,sx:{letterSpacing:"0.5px",mt:2,mb:2},children:"🧭 بررسی کالیبراسیون قطب‌نما"}),e.jsxs(be,{elevation:2,sx:{mb:2,py:2,px:1,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"#f5f7fa",borderRadius:3},children:[e.jsx(D,{fontWeight:"bold",fontSize:20,sx:{my:.5},children:I}),e.jsx(D,{variant:"body2",sx:{color:"#888",mb:-1},children:R})]}),e.jsxs(O,{display:"flex",gap:1,mb:2,children:[e.jsxs(O,{sx:{flex:1,bgcolor:"#e6fce6",borderRadius:2,px:2,py:1,textAlign:"center"},children:[e.jsx(D,{fontSize:13,color:"#55a84f",children:"دقت"}),e.jsx(D,{fontWeight:"bold",fontSize:19,color:"#388e3c",children:f==="--"?"--":f})]}),e.jsxs(O,{sx:{flex:1,bgcolor:"#e3f2fd",borderRadius:2,px:2,py:1,textAlign:"center"},children:[e.jsx(D,{fontSize:13,color:"#1976d2",children:"جهت فعلی"}),e.jsx(D,{fontWeight:"bold",fontSize:19,color:"#1976d2",children:g==="--"?"--":g})]})]}),e.jsxs(be,{elevation:1,sx:{mb:2,p:1.5,bgcolor:"#f7f8fa",borderRadius:3,minHeight:72},children:[e.jsxs(D,{fontWeight:"bold",fontSize:15,sx:{mb:1},children:[e.jsx("span",{role:"img","aria-label":"chart",children:"📊"})," داده‌های سنسور:"]}),e.jsxs(O,{sx:{display:"flex",gap:1.5,alignItems:"center",mb:1,justifyContent:"center"},children:[e.jsxs(D,{fontFamily:"monospace",fontSize:15,color:"#1976d2",children:["Alpha (Z): ",h]}),e.jsxs(D,{fontFamily:"monospace",fontSize:15,color:"#388e3c",children:["Beta (X): ",o]}),e.jsxs(D,{fontFamily:"monospace",fontSize:15,color:"#fb8c00",children:["Gamma (Y): ",d]})]}),e.jsxs(D,{variant:"caption",color:"#888",children:["تعداد خوانش: ",e.jsx("b",{children:c})]})]}),e.jsxs(O,{mb:1,mt:.5,children:[e.jsx(D,{fontSize:14,color:"#555",mb:.5,children:"کیفیت کالیبراسیون:"}),e.jsx(pn,{variant:"determinate",value:C,color:m,sx:{height:7,borderRadius:2,bgcolor:"#ffd4d4","& .MuiLinearProgress-bar":{borderRadius:2}}}),e.jsx(D,{fontWeight:"bold",color:m==="success"?"#388e3c":m==="warning"?"#fb8c00":"#d32f2f",fontSize:15,sx:{mt:.5,textAlign:"center"},children:b})]}),e.jsxs(O,{display:"flex",gap:1.5,mb:2,mt:1,children:[e.jsx(U,{fullWidth:!0,size:"large",variant:"contained",color:"primary",onClick:t?fe:me,sx:{fontWeight:"bold",fontSize:"16px",py:1.3},children:t?"⏹️ توقف":"🎯 شروع بررسی"}),e.jsx(U,{fullWidth:!0,size:"large",variant:"contained",color:"warning",onClick:()=>P(E=>!E),sx:{fontWeight:"bold",fontSize:"16px",py:1.3},children:"🔄 راهنمای کالیبراسیون"})]}),e.jsx(at,{in:k,sx:{mb:2},children:e.jsxs(be,{sx:{p:2,bgcolor:"#fffbe6",borderRight:"4px solid #ff9800",mb:2,borderRadius:2},children:[e.jsx(D,{fontWeight:"bold",mb:1,children:"📋 دستورات کالیبراسیون:"}),e.jsxs("ol",{style:{paddingRight:18,margin:0},children:[e.jsx("li",{children:"گوشی را در دست بگیرید"}),e.jsx("li",{children:"آن را به شکل عدد ۸ انگلیسی حرکت دهید"}),e.jsx("li",{children:"در همه جهات بچرخانید"}),e.jsx("li",{children:"حرکت را ۱۵ ثانیه ادامه دهید"})]})]})}),e.jsx(U,{startIcon:e.jsx(ot,{}),onClick:()=>de("/"),fullWidth:!0,variant:"outlined",color:"secondary",sx:{mt:0,fontWeight:"bold",fontSize:"16px",py:1.2,borderRadius:3,bgcolor:"#f8f8f8","&:hover":{bgcolor:"#ececec"}},children:"بازگشت به نقشه"}),z&&e.jsx(D,{color:"error",fontWeight:"bold",align:"center",mt:1,children:z})]})}function er(){const{hasUpdate:t,updateApp:r}=fn();return e.jsx("div",{style:{height:"100vh",width:"100vw",margin:0,padding:0,overflow:"hidden"},children:e.jsxs(hn,{theme:jn,children:[t&&e.jsx("div",{style:{position:"fixed",bottom:70,left:0,right:0,zIndex:9999,textAlign:"center"},children:e.jsx("button",{onClick:r,style:{padding:"14px 32px",borderRadius:10,fontWeight:"bold",fontSize:18,background:"#2196F3",color:"white",boxShadow:"0 2px 8px #0002",border:"none",cursor:"pointer"},children:"نسخه جدید آماده است! بروزرسانی"})}),e.jsx(gn,{basename:"/dataLogger",children:e.jsxs(xn,{children:[e.jsx(ze,{path:"/",element:e.jsx(Qn,{})}),e.jsx(ze,{path:"/calibration",element:e.jsx(Yn,{})}),e.jsx(ze,{path:"*",element:e.jsx(Xn,{})})]})})]})})}mn.createRoot(document.getElementById("root")).render(e.jsx(Pe.StrictMode,{children:e.jsx(er,{})}));
