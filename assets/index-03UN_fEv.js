import{r as a,c as Ut,j as e,D as Oe,a as Re,b as Ee,T as ue,F as X,I as Y,S as Le,M as $,d as Me,e as T,C as Z,R as Ue,f as ae,g as Te,B as U,h as I,i as O,P as ve,k as Bt,l as dt,m as W,n as Jt,A as Gt,o as Vt,L as pe,E as Be,W as Ht,p as N,q as ut,s as pt,t as _t,u as qt,v as ht,w as gt,x as we,y as $e,G as Zt,z as Kt,H as Je,J as Ge,K as Qt,N as Xt,O as xt,Q as Yt,U as en,V as tn,X as nn,Y as rn,Z as on,_ as sn,$ as an,a0 as De,a1 as ln,a2 as Ie,a3 as cn,a4 as nt,a5 as dn,a6 as un,a7 as pn,a8 as hn,a9 as gn,aa as rt,ab as ot,ac as Ae,ad as mt,ae as ft,af as st,ag as at,ah as xn,ai as mn,aj as fn,ak as it,al as lt,am as jn,an as yn,ao as bn,ap as Ne,aq as Sn}from"./vendor-bZHqI0o8.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function h(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(o){if(o.ep)return;o.ep=!0;const n=h(o);fetch(o.href,n)}})();function kn(){const t=a.useRef(null),[r,h]=a.useState(!1);a.useEffect(()=>{let o=!0;return"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(n=>{n.addEventListener("updatefound",()=>{const d=n.installing;d.addEventListener("statechange",()=>{d.state==="installed"&&navigator.serviceWorker.controller&&(t.current=d,o&&h(!0))})})}),()=>{o=!1}},[]);const l=()=>{t.current&&t.current.postMessage({type:"SKIP_WAITING"})};return a.useEffect(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()})},[]),{hasUpdate:r,updateApp:l}}const vn=Ut({palette:{primary:{main:"#1976D2"},secondary:{main:"#9C27B0"},success:{main:"#4CAF50"},error:{main:"#E53935"},warning:{main:"#FFC107"},info:{main:"#2196F3"},background:{default:"#f5f5f5",paper:"#fff"}},typography:{fontFamily:'"Roboto","Helvetica","Arial",sans-serif',h6:{fontWeight:600},button:{textTransform:"none",fontWeight:500}},components:{MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"8px 16px"}}},MuiDialog:{styleOverrides:{paper:{borderRadius:12,padding:"16px"}}}}});function wn({location:t,gpsMeta:r,onClose:h,onSave:l}){const[o,n]=a.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[d,p]=a.useState(""),g=(u,c)=>{n(j=>({...j,[u]:c}))},y=u=>{n(c=>({...c,transportModes:{...c.transportModes,[u]:!c.transportModes[u]}}))},f=()=>{if(!o.name.trim()){p("نام گره را وارد کنید");return}const u=Object.keys(o.transportModes).filter(c=>o.transportModes[c]);l({...o,latitude:t.lat,longitude:t.lng,timestamp:new Date().toISOString(),transportModes:u,gpsMeta:r?{coords:{latitude:r.coords.latitude,longitude:r.coords.longitude,accuracy:r.coords.accuracy,altitude:r.coords.altitude,speed:r.coords.speed,heading:r.coords.heading},timestamp:r.timestamp}:null}),h()};return e.jsxs(Oe,{open:!0,onClose:h,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(Re,{sx:{textAlign:"center",fontWeight:"bold"},children:"ایجاد گره جدید"}),e.jsxs(Ee,{dividers:!0,sx:{direction:"rtl"},children:[d&&e.jsx("div",{style:{color:"red",marginBottom:"16px",textAlign:"center"},children:d}),e.jsx(ue,{label:"نام گره",fullWidth:!0,margin:"normal",value:o.name,onChange:u=>g("name",u.target.value),required:!0,sx:{direction:"rtl"}}),e.jsx(ue,{label:"توضیحات",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:o.description,onChange:u=>g("description",u.target.value),sx:{direction:"rtl"}}),e.jsxs(X,{fullWidth:!0,margin:"normal",children:[e.jsx(Y,{children:"نوع گره"}),e.jsxs(Le,{value:o.type,onChange:u=>g("type",u.target.value),label:"نوع گره",children:[e.jsx($,{value:"checkpoint",children:"نقطه بازرسی"}),e.jsx($,{value:"landmark",children:"نشانه"}),e.jsx($,{value:"poi",children:"نقطه دلخواه"}),e.jsx($,{value:"other",children:"سایر"})]})]}),e.jsxs(X,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Y,{shrink:!0,children:"شیوه‌های حمل و نقل"}),e.jsxs(Me,{children:[e.jsx(T,{control:e.jsx(Z,{checked:o.transportModes.wheelchair,onChange:()=>y("wheelchair")}),label:"ویلچر"}),e.jsx(T,{control:e.jsx(Z,{checked:o.transportModes.electricVan,onChange:()=>y("electricVan")}),label:"ون برقی"}),e.jsx(T,{control:e.jsx(Z,{checked:o.transportModes.walking,onChange:()=>y("walking")}),label:"پیاده‌روی"})]})]}),e.jsxs(X,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Y,{shrink:!0,children:"جنسیت تردد"}),e.jsxs(Ue,{value:o.gender,onChange:u=>g("gender",u.target.value),children:[e.jsx(T,{value:"male",control:e.jsx(ae,{}),label:"مردانه"}),e.jsx(T,{value:"female",control:e.jsx(ae,{}),label:"زنانه"}),e.jsx(T,{value:"family",control:e.jsx(ae,{}),label:"خانوادگی"})]})]})]}),e.jsxs(Te,{children:[e.jsx(U,{onClick:h,color:"secondary",children:"انصراف"}),e.jsx(U,{onClick:f,color:"primary",variant:"contained",children:"ذخیره"})]})]})}function Mn({onSave:t,onClose:r,pathCoordinates:h}){const[l,o]=a.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[n,d]=a.useState(""),p=(f,u)=>{o(c=>({...c,[f]:u}))},g=f=>{o(u=>({...u,transportModes:{...u.transportModes,[f]:!u.transportModes[f]}}))},y=()=>{if(!l.name.trim()){d("نام مسیر را وارد کنید");return}const f=Object.keys(l.transportModes).filter(u=>l.transportModes[u]);t({...l,transportModes:f,coordinates:h,timestamp:new Date().toISOString()}),r()};return e.jsxs(Oe,{open:!0,onClose:r,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(Re,{sx:{textAlign:"center",fontWeight:"bold"},children:"ایجاد مسیر جدید"}),e.jsxs(Ee,{dividers:!0,children:[n&&e.jsx("div",{style:{color:"red",marginBottom:"16px",textAlign:"center"},children:n}),e.jsx(ue,{label:"نام مسیر",fullWidth:!0,margin:"normal",value:l.name,onChange:f=>p("name",f.target.value),required:!0}),e.jsx(ue,{label:"توضیحات",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:l.description,onChange:f=>p("description",f.target.value)}),e.jsxs(X,{fullWidth:!0,margin:"normal",children:[e.jsx(Y,{children:"نوع مسیر"}),e.jsxs(Le,{value:l.type,onChange:f=>p("type",f.target.value),label:"نوع مسیر",children:[e.jsx($,{value:"hiking",children:"پیاده‌روی"}),e.jsx($,{value:"driving",children:"رانندگی"}),e.jsx($,{value:"other",children:"سایر"})]})]}),e.jsxs(X,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Y,{shrink:!0,children:"شیوه‌های حمل و نقل"}),e.jsxs(Me,{children:[e.jsx(T,{control:e.jsx(Z,{checked:l.transportModes.wheelchair,onChange:()=>g("wheelchair")}),label:"ویلچر"}),e.jsx(T,{control:e.jsx(Z,{checked:l.transportModes.electricVan,onChange:()=>g("electricVan")}),label:"ون برقی"}),e.jsx(T,{control:e.jsx(Z,{checked:l.transportModes.walking,onChange:()=>g("walking")}),label:"پیاده‌روی"})]})]}),e.jsxs(X,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Y,{shrink:!0,children:"جنسیت تردد"}),e.jsxs(Ue,{value:l.gender,onChange:f=>p("gender",f.target.value),children:[e.jsx(T,{value:"male",control:e.jsx(ae,{}),label:"مردانه"}),e.jsx(T,{value:"female",control:e.jsx(ae,{}),label:"زنانه"}),e.jsx(T,{value:"family",control:e.jsx(ae,{}),label:"خانوادگی"})]})]})]}),e.jsxs(Te,{children:[e.jsx(U,{onClick:r,color:"secondary",children:"انصراف"}),e.jsx(U,{onClick:y,color:"primary",variant:"contained",children:"ذخیره"})]})]})}const Cn=[{key:"saturday",label:"شنبه"},{key:"sunday",label:"یک‌شنبه"},{key:"monday",label:"دوشنبه"},{key:"tuesday",label:"سه‌شنبه"},{key:"wednesday",label:"چهارشنبه"},{key:"thursday",label:"پنج‌شنبه"},{key:"friday",label:"جمعه"}];function Pn({onSave:t,onClose:r,polygonCoordinates:h}){const[l,o]=a.useState({name:"",description:"",type:"",transportModes:{wheelchair:!1,electricVan:!1,walking:!1},gender:""}),[n,d]=a.useState(""),[p,g]=a.useState({}),y=(c,j)=>o(b=>({...b,[c]:j})),f=c=>o(j=>({...j,transportModes:{...j.transportModes,[c]:!j.transportModes[c]}})),u=()=>{if(!l.name.trim()){d("نام محدوده را وارد کنید");return}const c=Object.keys(l.transportModes).filter(j=>l.transportModes[j]);t({...l,transportModes:c,coordinates:h,restrictedTimes:p,timestamp:new Date().toISOString()}),r()};return e.jsxs(Oe,{open:!0,onClose:r,maxWidth:"sm",dir:"rtl",fullWidth:!0,children:[e.jsx(Re,{sx:{textAlign:"center",fontWeight:"bold"},children:"ایجاد محدوده جدید"}),e.jsxs(Ee,{dividers:!0,children:[n&&e.jsx("div",{style:{color:"red",marginBottom:16,textAlign:"center"},children:n}),e.jsx(ue,{label:"نام محدوده",fullWidth:!0,margin:"normal",value:l.name,onChange:c=>y("name",c.target.value),required:!0}),e.jsx(ue,{label:"توضیحات",fullWidth:!0,margin:"normal",multiline:!0,rows:3,value:l.description,onChange:c=>y("description",c.target.value)}),e.jsxs(X,{fullWidth:!0,margin:"normal",children:[e.jsx(Y,{children:"نوع محدوده"}),e.jsxs(Le,{value:l.type,onChange:c=>y("type",c.target.value),label:"نوع محدوده",children:[e.jsx($,{value:"park",children:"پارک"}),e.jsx($,{value:"zone",children:"محدوده"}),e.jsx($,{value:"other",children:"سایر"})]})]}),e.jsxs(X,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Y,{shrink:!0,children:"شیوه‌های حمل و نقل"}),e.jsxs(Me,{children:[e.jsx(T,{control:e.jsx(Z,{checked:l.transportModes.wheelchair,onChange:()=>f("wheelchair")}),label:"ویلچر"}),e.jsx(T,{control:e.jsx(Z,{checked:l.transportModes.electricVan,onChange:()=>f("electricVan")}),label:"ون برقی"}),e.jsx(T,{control:e.jsx(Z,{checked:l.transportModes.walking,onChange:()=>f("walking")}),label:"پیاده‌روی"})]})]}),e.jsxs(X,{component:"fieldset",fullWidth:!0,margin:"normal",children:[e.jsx(Y,{shrink:!0,children:"جنسیت تردد"}),e.jsxs(Ue,{value:l.gender,onChange:c=>y("gender",c.target.value),children:[e.jsx(T,{value:"male",control:e.jsx(ae,{}),label:"مردانه"}),e.jsx(T,{value:"female",control:e.jsx(ae,{}),label:"زنانه"}),e.jsx(T,{value:"family",control:e.jsx(ae,{}),label:"خانوادگی"})]})]}),e.jsx(I,{variant:"subtitle1",sx:{fontWeight:"bold",mt:2,mb:1},children:e.jsx("span",{style:{borderBottom:"2px solid #999",paddingBottom:3},children:"زمان‌های محدودیت دسترسی"})}),e.jsx(O,{children:Cn.map(c=>e.jsxs(ve,{elevation:p[c.key]?2:0,sx:{mb:1,borderRadius:3,p:1,bgcolor:p[c.key]?"#f5f5f5":"transparent",transition:"background .2s"},children:[e.jsx(O,{display:"flex",alignItems:"center",children:e.jsx(T,{control:e.jsx(Bt,{checked:!!p[c.key],color:"primary",onChange:j=>{g(b=>j.target.checked?{...b,[c.key]:[{start:"",end:""}]}:Object.fromEntries(Object.entries(b).filter(([S])=>S!==c.key)))}}),label:e.jsx(I,{sx:{fontWeight:"bold"},children:c.label}),labelPlacement:"start",sx:{flex:1,mr:1}})}),e.jsx(dt,{in:!!p[c.key],children:e.jsxs(O,{mt:1,pl:2,pr:1,children:[(p[c.key]||[]).map((j,b)=>e.jsxs(O,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(ue,{size:"small",label:"از",type:"time",value:j.start,onChange:S=>{const C=S.target.value;g(x=>({...x,[c.key]:x[c.key].map((m,v)=>v===b?{...m,start:C}:m)}))},variant:"outlined",sx:{width:105,mx:.5,direction:"ltr",bgcolor:"#fff"},InputLabelProps:{shrink:!0,sx:{right:0,fontWeight:"bold"}},inputProps:{step:300,dir:"ltr",style:{textAlign:"center"}}}),e.jsx(I,{variant:"body2",sx:{mx:1},children:"تا"}),e.jsx(ue,{size:"small",label:"تا",type:"time",value:j.end,onChange:S=>{const C=S.target.value;g(x=>({...x,[c.key]:x[c.key].map((m,v)=>v===b?{...m,end:C}:m)}))},variant:"outlined",sx:{width:105,mx:.5,direction:"ltr",bgcolor:"#fff"},InputLabelProps:{shrink:!0,sx:{right:0,fontWeight:"bold"}},inputProps:{step:300,dir:"ltr",style:{textAlign:"center"}}}),e.jsx(W,{onClick:()=>g(S=>({...S,[c.key]:S[c.key].filter((C,x)=>x!==b)})),size:"small",color:"error",sx:{mx:.5},disabled:p[c.key].length===1,children:e.jsx(Jt,{fontSize:"small"})})]},b)),e.jsx(U,{onClick:()=>g(j=>({...j,[c.key]:[...j[c.key],{start:"",end:""}]})),color:"primary",size:"small",startIcon:e.jsx(Gt,{}),sx:{mt:1,fontWeight:"bold"},children:"افزودن بازه"})]})})]},c.key))})]}),e.jsxs(Te,{children:[e.jsx(U,{onClick:r,color:"secondary",children:"انصراف"}),e.jsx(U,{onClick:u,color:"primary",variant:"contained",children:"ذخیره"})]})]})}const Dn=[{value:"checkpoint",label:"نقطه بازرسی"},{value:"landmark",label:"نشانه"},{value:"poi",label:"نقطه دلخواه"},{value:"other",label:"سایر"}],In=[{value:"hiking",label:"پیاده‌روی"},{value:"driving",label:"رانندگی"},{value:"other",label:"سایر"}];function An({isOpen:t,onClose:r,filterOptions:h,setFilterOptions:l}){const o=(n,d)=>{l(p=>{const g=p[n]||[];return{...p,[n]:g.includes(d)?g.filter(y=>y!==d):[...g,d]}})};return e.jsxs(Oe,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,dir:"rtl",children:[e.jsx(Re,{sx:{fontWeight:"bold",textAlign:"center"},children:"فیلترسازی"}),e.jsxs(Ee,{children:[e.jsxs(O,{sx:{mb:2},children:[e.jsx(I,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"نوع نشانگر"}),e.jsx(Me,{children:Dn.map(n=>e.jsx(T,{control:e.jsx(Z,{checked:h.markerTypes.includes(n.value),onChange:()=>o("markerTypes",n.value)}),label:n.label},n.value))})]}),e.jsx(Vt,{sx:{my:1}}),e.jsxs(O,{children:[e.jsx(I,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"نوع مسیر"}),e.jsx(Me,{children:In.map(n=>e.jsx(T,{control:e.jsx(Z,{checked:h.pathTypes.includes(n.value),onChange:()=>o("pathTypes",n.value)}),label:n.label},n.value))})]})]}),e.jsx(Te,{children:e.jsx(U,{onClick:r,color:"primary",fullWidth:!0,variant:"contained",sx:{fontWeight:"bold",borderRadius:2},children:"بستن"})})]})}const On=({selectedItem:t,onDelete:r,onClose:h})=>{var d,p,g,y,f,u,c,j,b,S,C;const l=x=>!x||x.length===0?"ندارد":x.map(m=>{switch(m){case"wheelchair":return"ویلچر";case"electricVan":return"ون برقی";case"walking":return"پیاده‌روی";default:return m}}).join(", "),o=x=>Array.isArray(x)?Array.isArray(x[0])?x:x.map(m=>m.coordinates||[]):[],n=x=>{const m=o(x);if(m.length<2)return 0;let v=0;for(let A=1;A<m.length;A++){const[M,R]=m[A-1],[i,k]=m[A];v+=L.latLng(M,R).distanceTo(L.latLng(i,k))}return(v/1e3).toFixed(2)};return e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",borderRadius:"10px",boxShadow:"0 4px 15px rgba(0,0,0,0.2)",width:"90%",maxWidth:"400px",maxHeight:"80vh",overflowY:"auto",zIndex:1e3},children:[e.jsxs("h2",{style:{marginBottom:"15px",textAlign:"center",color:"#333"},children:["جزئیات ",t.type==="marker"?"نشانگر":t.type==="path"?"مسیر":t.type==="polygon"?"محدوده":""]}),e.jsxs("div",{style:{backgroundColor:"#f4f4f4",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نام:"})," ",((d=t.item.data)==null?void 0:d.name)||t.item.name||"بدون نام"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"توضیحات:"})," ",((p=t.item.data)==null?void 0:p.description)||t.item.description||"بدون توضیحات"]})]}),t.type==="marker"&&e.jsxs("div",{style:{backgroundColor:"#e9f5e9",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نوع نشانگر:"})," ",((g=t.item.data)==null?void 0:g.type)||"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"شیوه‌های حمل و نقل:"})," ",l((y=t.item.data)==null?void 0:y.transportModes)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"جنسیت تردد:"}),((f=t.item.data)==null?void 0:f.gender)==="male"?"مردانه":((u=t.item.data)==null?void 0:u.gender)==="female"?"زنانه":((c=t.item.data)==null?void 0:c.gender)==="family"?"خانوادگی":"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"موقعیت مکانی:"}),`${t.item.position[0].toFixed(4)}, ${t.item.position[1].toFixed(4)}`]})]}),t.type==="path"&&e.jsxs("div",{style:{backgroundColor:"#e6f2ff",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نوع مسیر:"})," ",t.item.type||"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"طول مسیر:"})," ",n(t.item.coordinates)," کیلومتر"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تعداد نقاط مسیر:"})," ",((j=t.item.coordinates)==null?void 0:j.length)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تاریخ ایجاد:"})," ",new Date(t.item.timestamp).toLocaleDateString("fa-IR")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"دقت GPS:"}),(S=(b=t.item.gpsMeta)==null?void 0:b.coords)!=null&&S.accuracy?`${t.item.gpsMeta.coords.accuracy} متر`:"اطلاعات موجود نیست"]})]}),t.type==="polygon"&&e.jsxs("div",{style:{backgroundColor:"#f5f4e6",padding:"15px",borderRadius:"8px",marginBottom:"15px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"نام محدوده:"})," ",t.item.name||"بدون نام"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"توضیحات:"})," ",t.item.description||"بدون توضیحات"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"نوع محدوده:"})," ",t.item.type||"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"شیوه‌های حمل و نقل:"})," ",(t.item.transportModes||[]).join(", ")||"ندارد"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"جنسیت تردد:"})," ",t.item.gender==="male"?"مردانه":t.item.gender==="female"?"زنانه":t.item.gender==="family"?"خانوادگی":"نامشخص"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تعداد نقاط:"})," ",((C=t.item.coordinates)==null?void 0:C.length)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"تاریخ ایجاد:"})," ",new Date(t.item.timestamp).toLocaleDateString("fa-IR")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"زمان‌های محدودیت:"}),e.jsx("br",{}),t.item.restrictedTimes&&Object.keys(t.item.restrictedTimes).length>0?e.jsx("ul",{style:{margin:0,paddingRight:18},children:Object.entries(t.item.restrictedTimes).map(([x,m])=>e.jsxs("li",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:{saturday:"شنبه",sunday:"یک‌شنبه",monday:"دوشنبه",tuesday:"سه‌شنبه",wednesday:"چهارشنبه",thursday:"پنج‌شنبه",friday:"جمعه"}[x]}),":"," ",m.map((v,A)=>e.jsxs("span",{children:[v.start," - ",v.end,A<m.length-1?" ، ":""]},A))]},x))}):"محدودیتی ثبت نشده است"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"15px"},children:[e.jsxs("button",{onClick:r,style:{backgroundColor:"#dc3545",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{children:"🗑️"})," بله، حذف شود"]}),e.jsxs("button",{onClick:h,style:{backgroundColor:"#6c757d",color:"white",border:"none",padding:"10px 20px",borderRadius:"5px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{children:"✖"})," انصراف"]})]})]})};function Rn({mapRef:t}){return a.useEffect(()=>{const r=t.current;r&&pe.control.rotate&&!r._rotateControlAdded&&(pe.control.rotate({position:"topright"}).addTo(r),r._rotateControlAdded=!0)},[t]),null}const En=()=>{const[t,r]=a.useState(()=>{const n=localStorage.getItem("mapMarkers");return n?JSON.parse(n):[]});return a.useEffect(()=>{localStorage.setItem("mapMarkers",JSON.stringify(t))},[t]),{markers:t,addMarker:n=>{r(d=>[...d,{...n,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removeMarker:n=>{r(d=>d.filter(p=>p.id!==n))},updateMarker:(n,d)=>{r(p=>p.map(g=>g.id===n?{...g,...d}:g))}}},Ln=()=>{const[t,r]=a.useState(()=>{const n=localStorage.getItem("mapPaths");return n?JSON.parse(n):[]});return a.useEffect(()=>{localStorage.setItem("mapPaths",JSON.stringify(t))},[t]),{paths:t,addPath:n=>{r(d=>[...d,{...n,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removePath:n=>{r(d=>d.filter(p=>p.id!==n))},updatePath:(n,d)=>{r(p=>p.map(g=>g.id===n?{...g,...d}:g))}}},Tn=()=>{const[t,r]=a.useState(()=>{const n=localStorage.getItem("mapPolygons");return n?JSON.parse(n):[]});return a.useEffect(()=>{localStorage.setItem("mapPolygons",JSON.stringify(t))},[t]),{polygons:t,addPolygon:n=>{r(d=>[...d,{...n,id:crypto.randomUUID(),timestamp:new Date().toISOString()}])},removePolygon:n=>{r(d=>d.filter(p=>p.id!==n))},updatePolygon:(n,d)=>{r(p=>p.map(g=>g.id===n?{...g,...d}:g))}}},zn=(t="geojson")=>{const r=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),h=JSON.parse(localStorage.getItem("mapPaths")||"[]"),l=JSON.parse(localStorage.getItem("mapPolygons")||"[]");let o,n,d;function p(c){return Array.isArray(c)?c.join(","):typeof c=="object"&&c!==null?Object.entries(c).filter(([j,b])=>b).map(([j])=>j).join(","):""}switch(t){case"geojson":const c={type:"FeatureCollection",features:[...r.map(i=>{var k,P;return{type:"Feature",geometry:{type:"Point",coordinates:[i.position[1],i.position[0]]},properties:{...i.data||{},transportModes:((k=i.data)==null?void 0:k.transportModes)||[],gender:((P=i.data)==null?void 0:P.gender)||""}}}),...h.map(i=>({type:"Feature",geometry:{type:"LineString",coordinates:Array.isArray(i.coordinates)?typeof i.coordinates[0]=="object"&&Array.isArray(i.coordinates[0].coordinates)?i.coordinates.map(k=>[k.coordinates[1],k.coordinates[0]]):i.coordinates.map(k=>[k[1],k[0]]):[]},properties:{name:i.name,description:i.description,type:i.type,timestamp:i.timestamp,transportModes:i.transportModes||[],gender:i.gender||""}})),...l.map(i=>({type:"Feature",geometry:{type:"Polygon",coordinates:[i.coordinates.map(k=>[k[1],k[0]])]},properties:{name:i.name,description:i.description,type:i.type,timestamp:i.timestamp,transportModes:i.transportModes||[],gender:i.gender||"",restrictedTimes:i.restrictedTimes||{}}}))]};o=JSON.stringify(c,null,2),n="application/geo+json",d="geojson";break;case"kml":const j=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
<Document>
`,b=`</Document>
</kml>`,S=r.map(i=>{const k=i.data||{},P=p(k.transportModes);return`
      <Placemark>
        <name>${k.name||""}</name>
        <description>${k.description||""}</description>
        <ExtendedData>
          <Data name="type"><value>${k.type||""}</value></Data>
          <Data name="transportModes"><value>${P}</value></Data>
          <Data name="gender"><value>${k.gender||""}</value></Data>
        </ExtendedData>
        <Point>
          <coordinates>${i.position[1]},${i.position[0]},0</coordinates>
        </Point>
      </Placemark>
      `}).join(""),C=h.map(i=>{const P=(Array.isArray(i.coordinates)?typeof i.coordinates[0]=="object"&&Array.isArray(i.coordinates[0].coordinates)?i.coordinates.map(D=>D.coordinates):i.coordinates:[]).map(D=>`${D[1]},${D[0]},0`).join(" "),F=p(i.transportModes);return`
      <Placemark>
        <name>${i.name||""}</name>
        <description>${i.description||""}</description>
        <ExtendedData>
          <Data name="type"><value>${i.type||""}</value></Data>
          <Data name="transportModes"><value>${F}</value></Data>
          <Data name="gender"><value>${i.gender||""}</value></Data>
        </ExtendedData>
        <LineString>
          <coordinates>
            ${P}
          </coordinates>
        </LineString>
      </Placemark>
      `}).join(""),x=l.map(i=>{const k=p(i.transportModes);let P=Array.isArray(i.coordinates)?i.coordinates.slice():[];P.length&&(P[0][0]!==P[P.length-1][0]||P[0][1]!==P[P.length-1][1])&&P.push(P[0]);const F=P.map(D=>`${D[1]},${D[0]},0`).join(" ");return`
    <Placemark>
      <name>${i.name||""}</name>
      <description>${i.description||""}</description>
      <ExtendedData>
        <Data name="type"><value>${i.type||""}</value></Data>
        <Data name="transportModes"><value>${k}</value></Data>
        <Data name="gender"><value>${i.gender||""}</value></Data>
        <Data name="restrictedTimes"><value>${i.restrictedTimes?JSON.stringify(i.restrictedTimes):""}</value></Data>
      </ExtendedData>
      <Polygon>
        <outerBoundaryIs>
          <LinearRing>
            <coordinates>
              ${F}
            </coordinates>
          </LinearRing>
        </outerBoundaryIs>
      </Polygon>
    </Placemark>
  `}).join("");o=j+S+C+x+b,n="application/vnd.google-earth.kml+xml",d="kml";break;case"csv":const m=`Type,Name,Description,PathType,TransportModes,Gender,Latitude,Longitude,Timestamp
`,v=r.map(i=>{const k=i.data||{};return["Point",`"${k.name||""}"`,`"${k.description||""}"`,"",`"${p(k.transportModes)}"`,`"${k.gender||""}"`,i.position[0],i.position[1],`"${i.timestamp}"`].join(",")}).join(`
`),A=h.map(i=>{const k=Array.isArray(i.coordinates)?typeof i.coordinates[0]=="object"&&Array.isArray(i.coordinates[0].coordinates)?i.coordinates.map(D=>D.coordinates):i.coordinates:[],[P,F]=k[0]||["",""];return["Line",`"${i.name||""}"`,`"${i.description||""}"`,`"${i.type||""}"`,`"${p(i.transportModes)}"`,`"${i.gender||""}"`,P,F,`"${i.timestamp}"`].join(",")}).join(`
`),M=l.map(i=>{const k=Array.isArray(i.coordinates)?i.coordinates:[],[P,F]=k[0]||["",""];return["Polygon",`"${i.name||""}"`,`"${i.description||""}"`,`"${i.type||""}"`,`"${p(i.transportModes)}"`,`"${i.gender||""}"`,`"${i.restrictedTimes?JSON.stringify(i.restrictedTimes):""}"`,P,F,`"${i.timestamp||""}"`].join(",")}).join(`
`);o=m+v+(v&&(A||M)?`
`:"")+A+(A&&M?`
`:"")+M,n="text/csv",d="csv";break;default:const R={version:"1.0",exportDate:new Date().toISOString(),markers:r,paths:h};o=JSON.stringify(R,null,2),n="application/json",d="json"}const g=new Blob([o],{type:n}),y=URL.createObjectURL(g),f=`map_export_${new Date().toISOString().replace(/[:.]/g,"-")}.${d}`,u=document.createElement("a");u.href=y,u.download=f,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(y)},Wn=t=>new Promise((r,h)=>{const l=new FileReader;l.onload=o=>{let n;try{n=JSON.parse(o.target.result)}catch{return h(new Error("Invalid JSON"))}if(n.version&&n.markers&&n.paths){const d=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),p=JSON.parse(localStorage.getItem("mapPaths")||"[]"),g=JSON.parse(localStorage.getItem("mapPolygons")||"[]"),y=n.markers.map(S=>({...S,id:crypto.randomUUID()})),f=n.paths.map(S=>({...S,id:crypto.randomUUID()})),u=Array.isArray(n.polygons)?n.polygons.map(S=>({...S,id:crypto.randomUUID()})):[],c=d.concat(y),j=p.concat(f),b=g.concat(u);return localStorage.setItem("mapMarkers",JSON.stringify(c)),localStorage.setItem("mapPaths",JSON.stringify(j)),localStorage.setItem("mapPolygons",JSON.stringify(b)),r({markers:c,paths:j,polygons:b})}if(n.type==="FeatureCollection"&&Array.isArray(n.features)){const d=JSON.parse(localStorage.getItem("mapMarkers")||"[]"),p=JSON.parse(localStorage.getItem("mapPaths")||"[]"),g=JSON.parse(localStorage.getItem("mapPolygons")||"[]"),y=[],f=[],u=[];n.features.forEach(S=>{const{geometry:C,properties:x={}}=S;if(C){if(C.type==="Point"){const[m,v]=C.coordinates;y.push({id:crypto.randomUUID(),position:[v,m],data:x,timestamp:x.timestamp||new Date().toISOString()})}else if(C.type==="LineString"){const m=C.coordinates.map(([v,A])=>[A,v]);f.push({id:crypto.randomUUID(),name:x.name||"",description:x.description||"",type:x.type||"",coordinates:m,timestamp:x.timestamp||new Date().toISOString()})}else if(C.type==="Polygon"){const m=C.coordinates[0].map(([v,A])=>[A,v]);u.push({id:crypto.randomUUID(),name:x.name||"",description:x.description||"",type:x.type||"",transportModes:x.transportModes||[],gender:x.gender||"",coordinates:m,timestamp:x.timestamp||new Date().toISOString()})}}});const c=d.concat(y),j=p.concat(f),b=g.concat(u);return localStorage.setItem("mapMarkers",JSON.stringify(c)),localStorage.setItem("mapPaths",JSON.stringify(j)),localStorage.setItem("mapPolygons",JSON.stringify(b)),r({markers:c,paths:j,polygons:b})}h(new Error("Invalid import file format"))},l.onerror=()=>h(new Error("File read error")),l.readAsText(t)});function Fn({latitude:t,longitude:r},h,l){const n=h*Math.PI/180,d=t+l*Math.cos(n)/6378137*(180/Math.PI),p=r+l*Math.sin(n)/(6378137*Math.cos(t*Math.PI/180))*(180/Math.PI);return{latitude:d,longitude:p}}function Nn(){const[t,r]=a.useState(!1),[h,l]=a.useState([]),o=a.useRef(null),n=a.useRef(null),d=a.useRef(null),p=a.useRef(0);return a.useEffect(()=>{const f=u=>{typeof u.alpha=="number"&&(p.current=u.alpha)};return window.addEventListener("deviceorientation",f,!0),()=>window.removeEventListener("deviceorientation",f,!0)},[]),a.useEffect(()=>{if(!t)return;const f=navigator.geolocation.watchPosition(u=>{const{latitude:c,longitude:j,accuracy:b,speed:S,heading:C}=u.coords,x=u.timestamp;n.current={latitude:c,longitude:j,timestamp:x};let m=o.current;if(!m)m={latitude:c,longitude:j,timestamp:x};else if(d.current){const v=(x-d.current)/1e3,M=(typeof S=="number"&&S>0?S:1)*v,R=(360-p.current)%360;m=Fn(m,R,M),console.log("DR in:",m,typeof m.latitude,typeof m.longitude)}o.current=m,d.current=x,l(v=>[...v,{gps:{latitude:c,longitude:j,accuracy:b,speed:S,heading:C,timestamp:x},dr:{latitude:m.latitude,longitude:m.longitude,timestamp:x}}])},u=>{},{enableHighAccuracy:!0,maximumAge:0,timeout:15e3});return()=>{navigator.geolocation.clearWatch(f),o.current=null,n.current=null,d.current=null}},[t]),{tracking:t,points:h,start:()=>{l([]),r(!0),o.current=null,n.current=null,d.current=null,navigator.geolocation.getCurrentPosition(f=>{const{latitude:u,longitude:c,accuracy:j,speed:b,heading:S}=f.coords,C=f.timestamp;n.current={latitude:u,longitude:c,timestamp:C},o.current={latitude:u,longitude:c,timestamp:C},d.current=C,l([{gps:{latitude:u,longitude:c,accuracy:j,speed:b,heading:S,timestamp:C},dr:{latitude:u,longitude:c,timestamp:C}}])},f=>console.warn("Initial GPS fetch failed:",f),{enableHighAccuracy:!0})},stop:()=>{r(!1)}}}function $n(){const[t,r]=a.useState(!0),[h,l]=a.useState(null);return a.useEffect(()=>{let o=null,n=0;function d(p){if(!p.absolute){r(!1),l("سنسور قطب‌نما کالیبره نیست. لطفاً با حرکت ۸ انگلیسی دستگاه را کالیبره کنید.");return}if(p.alpha==null||isNaN(p.alpha)||p.alpha===0&&p.beta===0&&p.gamma===0){r(!1),l("دریافت داده معتبر از سنسور قطب‌نما ممکن نیست. ممکن است دستگاه شما نیاز به کالیبره داشته باشد.");return}if(o!==null&&Math.abs(p.alpha-o)>80){if(n++,n>2){r(!1),l("سنسور قطب‌نما مشکوک به عدم کالیبراسیون است (پرش شدید زاویه).");return}}else n=0;o=p.alpha,r(!0),l(null)}return window.addEventListener("deviceorientation",d,!0),()=>window.removeEventListener("deviceorientation",d,!0)},[]),{calibrated:t,error:h}}function Un(){const{calibrated:t,error:r}=$n();return e.jsx(O,{sx:{display:"flex",alignItems:"center",justifyContent:"center",bgcolor:t?"#e8f5e9":"#fff3e0",color:t?"#388e3c":"#d32f2f",fontWeight:"bold",borderRadius:2,p:1,my:1,boxShadow:"0 2px 8px rgba(0,0,0,0.08)",fontSize:"15px"},children:t?e.jsxs(e.Fragment,{children:[e.jsx(Be,{sx:{mr:1}}),"سنسور قطب‌نما کالیبره است"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ht,{sx:{mr:1}}),r||"کالیبراسیون سنسور مورد نیاز است."]})})}function Bn(t){if(t.length<2)return 0;const[r,h]=t[t.length-2],[l,o]=t[t.length-1],n=l-r,d=o-h;return(Math.atan2(d,n)*180/Math.PI+360)%360}function Jn({position:t,heading:r}){const h=pe.divIcon({className:"",iconSize:[48,48],iconAnchor:[24,24],html:`
       <div style="
         transform: rotate(${r}deg);
         width: 48px; height: 48px;
         display: flex;
         align-items: center;
         justify-content: center;
       ">
         <!-- simple arrow SVG -->
         <svg width="32" height="32" viewBox="0 0 24 24" fill="orange" xmlns="http://www.w3.org/2000/svg">
           <path d="M12 2 L19 21 L12 17 L5 21 Z"/>
         </svg>
       </div>
     `});return e.jsx(Je,{position:t,icon:h})}function ct(t,r){return t.map(h=>h[r]&&h[r].latitude&&h[r].longitude?[h[r].latitude,h[r].longitude]:null).filter(Boolean)}function Gn(t){const r=`timestamp,gps_lat,gps_lng,gps_accuracy,dr_lat,dr_lng
`,h=t.map(d=>`${d.gps.timestamp},${d.gps.latitude},${d.gps.longitude},${d.gps.accuracy||""},${d.dr.latitude},${d.dr.longitude}`).join(`
`),l=new Blob([r+h],{type:"text/csv"}),o=URL.createObjectURL(l),n=document.createElement("a");n.href=o,n.download="dualtrack.csv",n.click()}function Vn(t){const r={type:"Feature",properties:{source:"gps"},geometry:{type:"LineString",coordinates:t.map(p=>[p.gps.longitude,p.gps.latitude])}},h={type:"Feature",properties:{source:"deadReckoning"},geometry:{type:"LineString",coordinates:t.map(p=>[p.dr.longitude,p.dr.latitude])}},l={type:"FeatureCollection",features:[r,h]},o=new Blob([JSON.stringify(l,null,2)],{type:"application/geo+json"}),n=URL.createObjectURL(o),d=document.createElement("a");d.href=n,d.download="dualtrack.geojson",d.click()}function Hn({gps:t,dr:r,mode:h}){const l=Ge();return a.useEffect(()=>{h==="gps"&&t?l.setView([t.latitude,t.longitude],l.getZoom()):h==="dr"&&r&&l.setView([r.latitude,r.longitude],l.getZoom())},[t,r,h,l]),null}function _n({mode:t,actions:r,mapHeight:h}){const{tracking:l,points:o,start:n,stop:d}=Nn(),p=()=>{n(),j("gps")},g=o.length?o[o.length-1].gps:null,y=o.length?o[o.length-1].dr:null,f=ct(o,"gps"),u=ct(o,"dr"),[c,j]=a.useState(t==="mapOnly"?"gps":"off"),[b,S]=a.useState(null),[C,x]=a.useState(null),m=a.useRef(null),v=a.useRef(!1),A=Bn(u);return a.useEffect(()=>{t==="full"&&!l&&m.current&&navigator.geolocation.getCurrentPosition(M=>{const R=M.coords.latitude,i=M.coords.longitude;S({latitude:R,longitude:i}),m.current.setView([R,i],17),v.current=!0},M=>{console.warn("Failed to fetch initial GPS:",M)},{enableHighAccuracy:!0})},[t,l,m.current]),a.useEffect(()=>{const M=g||b;t==="full"&&M&&!v.current&&x(M),t!=="full"&&(v.current=!1)},[t,g,b]),e.jsxs(O,{sx:{height:"100%",display:"flex",flexDirection:"column",direction:"rtl"},children:[e.jsx(O,{sx:{textAlign:"center",py:1},children:e.jsx(I,{variant:"h6",fontSize:15,children:"مسیرآزمایشی مقایسه GPS و Dead Reckoning"})}),e.jsxs(O,{sx:{display:"flex",justifyContent:"center",gap:2,pb:1},children:[e.jsx(N,{title:l?"پایان مسیر":"شروع مسیر",children:e.jsx(W,{color:l?"error":"success",onClick:l?d:p,size:"large",children:l?e.jsx(ut,{}):e.jsx(pt,{})})}),e.jsx(N,{title:"خروجی CSV",children:e.jsx("span",{children:e.jsx(W,{color:"success",disabled:!o.length,onClick:()=>Gn(o),size:"large",children:e.jsx(_t,{})})})}),e.jsx(N,{title:"خروجی GeoJSON",children:e.jsx("span",{children:e.jsx(W,{color:"info",disabled:!o.length,onClick:()=>Vn(o),size:"large",children:e.jsx(qt,{})})})})]}),e.jsx(Un,{}),e.jsxs(O,{sx:{flex:1,minHeight:0},children:[e.jsxs(ht,{center:f.length?f[f.length-1]:[36.2972,59.6067],zoom:16,style:{height:"100%",width:"100%"},whenCreated:M=>{m.current=M,t!=="compact"&&navigator.geolocation.getCurrentPosition(R=>M.setView([R.coords.latitude,R.coords.longitude],17),R=>console.warn("Failed to fetch initial GPS:",R),{enableHighAccuracy:!0})},children:[e.jsx(gt,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(we,{positions:f,color:"blue",weight:5,opacity:.7}),e.jsx(we,{positions:u,color:"orange",weight:4,opacity:.7,dashArray:"6 8"}),g&&e.jsx($e,{center:[g.latitude,g.longitude],radius:6,color:"blue"}),y&&e.jsx($e,{center:[y.latitude,y.longitude],radius:6,color:"orange"}),u.length>0&&e.jsx(Jn,{position:u[u.length-1],heading:A}),e.jsx(Hn,{gps:g,dr:y,mode:c})]}),e.jsx(O,{sx:{position:"absolute",bottom:46,right:23,zIndex:1e3,backgroundColor:"#fff",borderRadius:"50%",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"},children:e.jsx(N,{title:`دنبال‌کردن: ${c==="gps"?"GPS":c==="dr"?"DR":"خاموش"}`,children:e.jsx(W,{onClick:()=>j(M=>M==="off"?"gps":M==="gps"?"dr":"off"),color:c==="off"?"default":c==="gps"?"primary":"warning",size:"large",children:c==="gps"?e.jsx(Zt,{}):c==="dr"?e.jsx(Be,{}):e.jsx(Kt,{})})})})]}),o.length>0&&e.jsxs(O,{sx:{py:1,px:2},children:[e.jsxs(I,{variant:"subtitle2",children:["تعداد نقاط: ",o.length]}),e.jsxs(I,{variant:"body2",children:["آخرین GPS: ",g?`${g.latitude.toFixed(6)}, ${g.longitude.toFixed(6)}`:"-",e.jsx("br",{}),"آخرین Dead Reckoning: ",y?`${y.latitude.toFixed(6)}, ${y.longitude.toFixed(6)}`:"-",e.jsx("br",{}),"خطای لحظه‌ای (متر): ",g&&y?Math.sqrt(Math.pow((g.latitude-y.latitude)*111320,2)+Math.pow((g.longitude-y.longitude)*40075e3*Math.cos(g.latitude*Math.PI/180)/360,2)).toFixed(2):"-"]})]})]})}function qn({isTracking:t,onStartTracking:r,onStopTracking:h,onAddMarker:l,onExport:o,onImportClick:n,onFilter:d,onStartManualPath:p,isDrawingPath:g,onStartPolygon:y,isDrawingPolygon:f,onPanelToggle:u}){const c=Qt(),b=Xt(c.breakpoints.down("sm"))?"small":"medium",[S,C]=a.useState(null),x=D=>{C(D.currentTarget)},m=D=>{C(null),D&&typeof o=="function"&&o(D)},[v,A]=a.useState(!1),[M,R]=a.useState("closed"),i=M!=="closed",k=()=>{R(M==="full"?"compact":"full"),u&&u(!0)},P=()=>{R("closed"),u&&u(!1)},F=xt();return e.jsxs(Yt,{position:"fixed",color:"inherit",sx:{top:"auto",bottom:0},children:[e.jsxs(en,{sx:{justifyContent:"space-around"},children:[e.jsx(N,{title:t?"توقف ردیابی":"شروع ردیابی",arrow:!0,children:e.jsx(W,{color:t?"error":"success",onClick:t?h:r,size:b,children:t?e.jsx(ut,{}):e.jsx(pt,{})})}),e.jsx(N,{title:"نشانگر",arrow:!0,children:e.jsx(W,{color:"primary",onClick:l,size:b,children:e.jsx(tn,{})})}),e.jsx(N,{title:"مسیر دستی",arrow:!0,children:e.jsx(W,{color:g?"success":"primary",onClick:p,size:b,children:e.jsx(nn,{})})}),e.jsx(N,{title:f?"در حال ترسیم محدوده":"محدوده جدید",arrow:!0,children:e.jsx(W,{color:f?"success":"primary",onClick:y,size:b,children:e.jsx(rn,{})})}),e.jsx(N,{title:"فیلتر",arrow:!0,children:e.jsx(W,{color:"secondary",onClick:d,size:b,children:e.jsx(on,{})})}),e.jsx(N,{title:"خروجی",arrow:!0,children:e.jsx(W,{color:"warning",onClick:x,size:b,children:e.jsx(sn,{})})}),e.jsxs(an,{anchorEl:S,open:!!S,onClose:()=>m(),children:[e.jsxs($,{onClick:()=>m("geojson"),children:[e.jsx(De,{children:e.jsx(ln,{fontSize:"small"})}),e.jsx(Ie,{children:"GeoJSON"})]}),e.jsxs($,{onClick:()=>m("kml"),children:[e.jsx(De,{children:e.jsx(cn,{fontSize:"small"})}),e.jsx(Ie,{children:"KML"})]}),e.jsxs($,{onClick:()=>m("csv"),children:[e.jsx(De,{children:e.jsx(nt,{fontSize:"small"})}),e.jsx(Ie,{children:"CSV"})]}),e.jsxs($,{onClick:()=>m("json"),children:[e.jsx(De,{children:e.jsx(nt,{fontSize:"small"})}),e.jsx(Ie,{children:"JSON"})]})]}),e.jsx(N,{title:"ورودی",arrow:!0,children:e.jsx(W,{color:"inherit",onClick:n,size:b,children:e.jsx(dn,{})})}),e.jsx(N,{title:"تست مسیر GPS/DR",arrow:!0,children:e.jsx(W,{color:"info",onClick:()=>{R("full"),u&&u(!0)},size:"large",children:e.jsx(un,{})})}),e.jsx(N,{title:"بررسی کالیبراسیون قطب‌نما",arrow:!0,children:e.jsx(W,{color:"info",onClick:()=>F("/calibration"),size:b,children:e.jsx(Be,{})})})]}),e.jsx(pn,{direction:"up",in:i,mountOnEnter:!0,unmountOnExit:!0,children:e.jsxs(ve,{elevation:20,sx:{position:"fixed",left:0,right:0,bottom:0,height:M==="full"?"100dvh":"25vh",borderTopLeftRadius:24,borderTopRightRadius:24,zIndex:2e4,bgcolor:"background.paper",boxShadow:16,display:"flex",flexDirection:"column",pt:1,pb:1},children:[e.jsxs(O,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2},children:[e.jsx(N,{title:"بستن",children:e.jsx(W,{onClick:P,children:"×"})}),e.jsx(I,{sx:{fontWeight:"bold",fontSize:"16px"},children:"تست مسیر GPS/DR"}),e.jsx(N,{title:M==="full"?"حالت کوچک":"تمام صفحه",children:e.jsx(W,{onClick:k,children:M==="full"?e.jsx(hn,{}):e.jsx(gn,{})})})]}),e.jsx(O,{sx:{flex:1,minHeight:0,px:2,pb:2},children:e.jsx(_n,{mode:M})})]})})]})}console.log(pe.control.rotate);console.log(pe.version);const Zn=pe.divIcon({className:"center-marker-icon",html:'<div class="center-pin">📍</div>',iconSize:[20,26],iconAnchor:[10,26],popupAnchor:[0,-26]});pe.divIcon({className:"custom-marker-icon",html:`
    <div style="
      width: 30px; 
      height: 30px; 
      background-color: #2196F3; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      color: white; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    ">
      📍
    </div>
  `,iconSize:[30,30],iconAnchor:[15,15]});function Kn({position:t,children:r,...h}){const l=a.useRef(null);return a.useEffect(()=>{const o=l.current;o&&(o.off("click"),o.on("click",()=>h.onClick&&h.onClick()))},[h]),e.jsxs(Je,{ref:l,position:t,...h,children:[e.jsx(mt,{children:r}),"  "]})}const Qn={checkpoint:"#e53935",landmark:"#1e88e5",poi:"#fb8c00",other:"#6d4c41"};function Xn(t){const r=Qn[t]||"#757575",h=t?t[0].toUpperCase():"";return pe.divIcon({className:"category-marker-icon",html:`
      <div style="
        width:30px; height:30px;
        background:${r};
        border-radius:50%;
        display:flex; align-items:center; justify-content:center;
        color:white; font-size:16px; font-weight:bold;
        box-shadow:0 2px 5px rgba(0,0,0,0.3);
      ">${h}</div>
    `,iconSize:[30,30],iconAnchor:[15,15]})}function Yn({onPositionChange:t}){const r=Ge();return a.useEffect(()=>{t(r.getCenter())},[]),ft({dragend:()=>t(r.getCenter()),zoomend:()=>t(r.getCenter())}),null}function er({onMapClick:t,manualMode:r}){return ft({click:h=>{r||t(h.latlng)}}),null}function tr({position:t,zoom:r}){const h=Ge();return a.useEffect(()=>{t&&h.setView(t,r)},[t,r]),null}const nr=()=>{const[t,r]=a.useState([36.2972,59.6067]),[h,l]=a.useState(12),[o,n]=a.useState(null),[d,p]=a.useState(null),[g,y]=a.useState([]),[f,u]=a.useState(null),[c,j]=a.useState(null),[b,S]=a.useState(!1),[C,x]=a.useState(!1),[m,v]=a.useState(null),[A,M]=a.useState(!1),[R,i]=a.useState("street"),k=a.useRef(null),[P,F]=a.useState(null),[D,fe]=a.useState(!1),[ee,je]=a.useState([]),[ye,K]=a.useState([]),[be,he]=a.useState(null),[ge,xe]=a.useState(!1),[me,Se]=a.useState([]),[E,te]=a.useState(!1),H=a.useRef(!1),{polygons:_,addPolygon:ie,removePolygon:J}=Tn(),[le,q]=a.useState(!1),[G,V]=a.useState(null),[B,ne]=a.useState(!1),[Q,ze]=a.useState(null),Ve=a.useRef(null),jt=(s="json")=>{zn(s)},[re,yt]=a.useState({markerTypes:[],pathTypes:[],transportModes:[],gender:[]}),bt={street:"Street View",esri:"Esri World Imagery",eox:"EOX S2 Cloudless 2020"},He={street:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",esri:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",eox:"https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2020_3857/default/g/{z}/{y}/{x}.jpg"},{markers:_e,addMarker:qe,removeMarker:Ze}=En(),{paths:Ke,addPath:We,removePath:Qe}=Ln(),Ce=a.useRef(null),Xe=a.useCallback(()=>{if(u(null),!navigator.geolocation){u("موقعیت مکانی در دستگاه شما پشتیبانی نمی‌شود");return}const s={enableHighAccuracy:!0,timeout:3e4,maximumAge:0};navigator.geolocation.getCurrentPosition(w=>{const{latitude:oe,longitude:ce,accuracy:se}=w.coords,z=[oe,ce];n(z),F(w),p(se),r(z),l(15)},w=>{switch(w.code){case w.PERMISSION_DENIED:u("دسترسی به موقعیت مکانی رد شد");break;case w.POSITION_UNAVAILABLE:u("اطلاعات موقعیت در دسترس نیست");break;case w.TIMEOUT:u("زمان درخواست موقعیت مکانی به پایان رسید");break;default:u("خطا در دریافت موقعیت مکانی")}r([36.2972,59.6067]),l(12)},s)},[]),St=()=>{fe(!0),je([]),u(null)},kt=()=>{ee.length>1?(fe(!1),he("manual"),x(!0)):u("مسیر بسیار کوتاه است. حداقل دو نقطه نیاز است.")},vt=a.useRef(g),wt=()=>{xe(!0),Se([])},Mt=()=>{me.length>=3?(xe(!1),te(!0)):alert("حداقل سه نقطه نیاز است.")},Ct=s=>{ie(s),te(!1),Se([]),xe(!1)};a.useEffect(()=>{vt.current=g},[g]);const Pt=()=>{S(!0),y([]),u(null),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{y(s=>(s.length===0&&(Fe(),u("عدم موفقیت در دریافت موقعیت مکانی. لطفاً مجدداً تلاش کنید.")),s))},3e4),Ce.current=navigator.geolocation.watchPosition(s=>{console.log("GPS update:",s.coords.latitude,s.coords.longitude,"accuracy:",s.coords.accuracy),F(s);const{latitude:w,longitude:oe,accuracy:ce,altitude:se,speed:z,heading:Pe}=s.coords,ke=[w,oe];clearTimeout(k.current),ce<=5e3&&(n(ke),u(null),y(de=>{if(de.length===0)return[...de,ke];const et=de[de.length-1],tt=1e-6;return Math.abs(et[0]-w)>tt||Math.abs(et[1]-oe)>tt?[...de,ke]:de}),K(de=>[...de,{coords:{latitude:w,longitude:oe,accuracy:ce,altitude:se,speed:z,heading:Pe},timestamp:s.timestamp}]))},s=>{console.error("Tracking error:",s),clearTimeout(k.current);let w="خطا در دریافت موقعیت";switch(s.code){case s.PERMISSION_DENIED:w="دسترسی به موقعیت مکانی رد شد";break;case s.POSITION_UNAVAILABLE:w="اطلاعات موقعیت در دسترس نیست";break;case s.TIMEOUT:w="زمان درخواست موقعیت مکانی به پایان رسید";break}u(w),Fe()},{enableHighAccuracy:!0,timeout:3e4,maximumAge:0,distanceFilter:1})},Fe=()=>{Ce.current&&(navigator.geolocation.clearWatch(Ce.current),Ce.current=null),S(!1),g.length>1?(he("gps"),x(!0)):(y([]),u("مسیر بسیار کوتاه است. لطفاً مسافت بیشتری را طی کنید."))},Ye=s=>{v({type:"marker",item:s})},Dt=s=>{v({type:"path",item:s})},It=()=>{if(m){const{type:s,item:w}=m;s==="marker"?Ze(w.id):s==="path"?Qe(w.id):s==="polygon"&&J(w.id),v(null)}},At=s=>{We({...s,coordinates:g,pointsMeta:ye}),x(!1),y([]),K([])};a.useEffect(()=>{Xe()},[Xe]);const Ot=()=>{ne(!0),ze(null)},Rt=()=>{Q?(ne(!1),j({lat:Q.lat,lng:Q.lng})):u("لطفاً جایگاه را تنظیم کنید")},Et=()=>{ne(!1),ze(null)},Lt=s=>{if(!B){if(H.current){H.current=!1;return}if(!(m||E||C||c)){if(ge){Se(w=>[...w,[s.lat,s.lng]]);return}if(D){je(w=>[...w,{coordinates:[s.lat,s.lng],gpsMeta:P?{coords:{...P.coords},timestamp:P.timestamp}:null}]);return}V(s),j({lat:s.lat,lng:s.lng})}}},Tt=s=>{qe({position:[s.latitude,s.longitude],data:s}),j(null)},zt=s=>{const w=s.target.files[0];w&&Wn(w).then(({markers:oe,paths:ce,polygons:se})=>{_e.forEach(z=>Ze(z.id)),Ke.forEach(z=>Qe(z.id)),_.forEach(z=>J(z.id)),oe.forEach(z=>qe(z)),ce.forEach(z=>We(z)),se&&se.forEach(z=>ie(z)),alert("اطلاعات با موفقیت وارد شد!")})},Wt=_e.filter(s=>{var se,z,Pe;const w=re.markerTypes.length===0||re.markerTypes.includes((se=s.data)==null?void 0:se.type),oe=re.transportModes.length===0||((z=s.data)==null?void 0:z.transportModes)&&s.data.transportModes.some(ke=>re.transportModes.includes(ke)),ce=re.gender.length===0||re.gender.includes((Pe=s.data)==null?void 0:Pe.gender);return w&&oe&&ce}),Ft=Ke.filter(s=>re.pathTypes.length===0||re.pathTypes.includes(s.type)),Nt=s=>{We({...s,coordinates:ee}),x(!1),je([]),fe(!1)},$t=s=>{switch(s){case"hiking":return"#4CAF50";case"cycling":return"#2196F3";case"driving":return"#FF9800";default:return"#9C27B0"}};return e.jsxs("div",{className:`map-container ${B?"manual-marker-mode":""}`,children:[e.jsx(O,{sx:{position:"absolute",top:"10px",right:"10px",backgroundColor:"#ffffffee",padding:"10px",borderRadius:"8px",zIndex:le?500:1200,boxShadow:"0 2px 6px rgba(0,0,0,0.15)",direction:"rtl",minWidth:"180px"},children:e.jsxs(X,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(Y,{id:"map-layer-label",style:{right:"0px",fontWeight:"bold"},children:"نقشه پایه"}),e.jsx(Le,{labelId:"map-layer-label",id:"map-layer-select",value:R,label:"نقشه پایه",onChange:s=>i(s.target.value),children:Object.keys(He).map(s=>e.jsx($,{value:s,children:bt[s]||s},s))})]})}),C&&e.jsx(Mn,{onSave:be==="manual"?Nt:At,onClose:()=>{x(!1),be==="manual"?(je([]),fe(!1)):y([]),he(null)},pathCoordinates:be==="manual"?ee:g}),c&&e.jsx(wn,{location:c,gpsMeta:P,onClose:()=>j(null),onSave:Tt}),A&&e.jsx(An,{isOpen:A,onClose:()=>M(!1),filterOptions:re,setFilterOptions:yt}),m&&e.jsx(On,{selectedItem:m,onDelete:It,onClose:()=>v(null)}),e.jsxs(ht,{zoom:h,scrollWheelZoom:!0,tap:!0,style:{width:"100%",height:"100%",position:"absolute",margin:0,padding:0,direction:"rtl"},whenCreated:s=>{Ve.current=s},children:[e.jsx(tr,{position:t,zoom:h}),e.jsx(Rn,{mapRef:Ve}),e.jsx(er,{onMapClick:Lt,manualMode:B}),e.jsx(gt,{url:He[R],maxZoom:21,attribution:'© <a href="wapco.ir">wapco</a> contributors'}),o&&d&&e.jsxs(e.Fragment,{children:[e.jsx($e,{center:o,radius:d,color:"#e6f2ff",fillColor:"#1976d2",fillOpacity:.1,weight:2}),e.jsx(rt,{center:o,radius:6,pathOptions:{color:"#e6f2ff",weight:2,fillColor:"#1976d2",fillOpacity:1}})]}),g.length>0&&e.jsx(we,{positions:g,color:"blue",weight:5,opacity:b?.7:1}),D&&ee.length>0&&e.jsx(we,{positions:ee.map(s=>s.coordinates),color:"blue",weight:5,opacity:.7}),ge&&me.length>1&&e.jsx(ot,{positions:me,pathOptions:{color:"purple",fillOpacity:.2}}),_.map(s=>e.jsx(ot,{positions:s.coordinates,pathOptions:{color:"purple",fillOpacity:.2},eventHandlers:{click:w=>{w.originalEvent&&w.originalEvent.stopPropagation&&w.originalEvent.stopPropagation(),H.current=!0,v({type:"polygon",item:s})}}},s.id)),E&&e.jsx(Pn,{onSave:Ct,onClose:()=>te(!1),polygonCoordinates:me}),B&&e.jsxs(e.Fragment,{children:["  ",e.jsx(Yn,{onPositionChange:ze}),Q&&e.jsx(Je,{position:[Q.lat,Q.lng],icon:Zn})," "]}),G&&e.jsx(rt,{center:G,radius:6,pathOptions:{color:"black",fillColor:"black",fillOpacity:1}}),Wt.map(s=>e.jsx(Kn,{position:s.position,icon:Xn(s.data.type),onClick:()=>Ye(s),eventHandlers:{click:()=>Ye(s)}},s.id)),Ft.map(s=>(Array.isArray(s.coordinates)&&typeof s.coordinates[0]=="object"&&Array.isArray(s.coordinates[0].coordinates)?s.coordinates.map(w=>w.coordinates):Array.isArray(s.coordinates[0])&&s.coordinates,e.jsx(Ae.Fragment,{children:e.jsx(we,{positions:Array.isArray(s.coordinates)&&s.coordinates.length>0?typeof s.coordinates[0]=="object"&&Array.isArray(s.coordinates[0].coordinates)?s.coordinates.map(w=>w.coordinates):s.coordinates:[],color:$t(s.type),weight:5,opacity:.7,eventHandlers:{click:()=>Dt(s)},children:e.jsx(mt,{children:e.jsxs("div",{children:[e.jsx("strong",{children:s.name}),e.jsx("p",{children:s.description}),e.jsxs("p",{children:["نوع مسیر: ",s.type]})]})})})},s.id)))]}),e.jsx(qn,{isTracking:b,onStartTracking:Pt,onStopTracking:Fe,onAddMarker:Ot,onExport:jt,onImportClick:()=>document.getElementById("importInput").click(),onFilter:()=>M(!0),onStartManualPath:St,isDrawingPath:D,onStartPolygon:wt,isDrawingPolygon:ge,onPanelToggle:q}),B&&e.jsxs(e.Fragment,{children:[" ",e.jsx(U,{onClick:Rt,variant:"contained",color:"success",sx:{position:"fixed",bottom:80,right:20,zIndex:1300},children:"پایان نشانگر و ذخیره"}),e.jsx(U,{onClick:Et,variant:"contained",color:"warning",sx:{position:"fixed",bottom:80,right:160,zIndex:1300},children:"لغو"})," "]}),D&&e.jsx(U,{onClick:kt,variant:"contained",color:"success",style:{position:"fixed",bottom:70,right:20,zIndex:9999},children:"پایان مسیر و ذخیره"}),ge&&me.length>=3&&e.jsx(U,{onClick:Mt,variant:"contained",color:"success",style:{position:"fixed",bottom:70,right:90,zIndex:9999},children:"پایان محدوده و ذخیره"}),e.jsx("input",{id:"importInput",type:"file",accept:".json",onChange:zt,style:{display:"none"}})]})};function rr(){return e.jsx("div",{style:{textAlign:"center",marginTop:100,fontWeight:"bold",color:"red"},children:"صفحه پیدا نشد!"})}function or(){const[t,r]=a.useState(!1),[h,l]=a.useState("--"),[o,n]=a.useState("--"),[d,p]=a.useState("--"),[g,y]=a.useState("--"),[f,u]=a.useState("--"),[c,j]=a.useState(0),[b,S]=a.useState("--"),[C,x]=a.useState(0),[m,v]=a.useState("error"),[A,M]=a.useState("در انتظار شروع"),[R,i]=a.useState("روی دکمه شروع کلیک کنید"),[k,P]=a.useState(!1),[F,D]=a.useState(""),[fe,ee]=a.useState(e.jsx(st,{color:"action",fontSize:"large"})),[je,ye]=a.useState("#f5f7fa"),K=a.useRef([]),be=a.useRef(null),he=a.useRef(!1),ge=xt();function xe(E){if(!he.current||E.alpha==null)return;const te=E.alpha,H=E.beta,_=E.gamma;if(K.current.push({alpha:te,beta:H,gamma:_}),l(te.toFixed(1)+"°"),n(H.toFixed(1)+"°"),p(_.toFixed(1)+"°"),y(te.toFixed(1)+"°"),j(K.current.length),K.current.length>=10){const J=K.current.slice(-50).map(ne=>ne.alpha),le=J.reduce((ne,Q)=>ne+Q,0)/J.length,q=Math.sqrt(J.reduce((ne,Q)=>ne+Math.pow(Q-le,2),0)/J.length);let G="ضعیف",V=20,B="error";q<5?(G="عالی",V=100,B="success"):q<15?(G="خوب",V=70,B="warning"):q<30&&(G="متوسط",V=40,B="warning"),S(G),x(V),v(B),u("±"+q.toFixed(1)+"°")}}const me=async()=>{if(D(""),!window.DeviceOrientationEvent){D("سنسور جهت‌یابی پشتیبانی نمی‌شود.");return}if(typeof window.DeviceOrientationEvent.requestPermission=="function")try{if(await window.DeviceOrientationEvent.requestPermission()!=="granted"){D("دسترسی به سنسور قطب‌نما توسط کاربر رد شد.");return}}catch(E){D("خطا در درخواست دسترسی: "+E.message);return}K.current=[],l("--"),n("--"),p("--"),y("--"),u("--"),j(0),S("--"),x(0),v("error"),M("در حال نظارت"),i("گوشی را حرکت دهید (مثل ۸ انگلیسی)"),ee(e.jsx(fn,{color:"primary",fontSize:"large",sx:{animation:"spin 1.2s linear infinite"}})),ye("#e3f2fd"),r(!0),he.current=!0,be.current=Date.now(),window.addEventListener("deviceorientation",xe)},Se=()=>{if(r(!1),he.current=!1,window.removeEventListener("deviceorientation",xe),!K.current.length){M("خطا"),ee(e.jsx(it,{color:"error",fontSize:"large"})),ye("#ffeaea"),i("داده‌ای دریافت نشد. سنسور قطب‌نما کار نمی‌کند"),S("--"),x(0),v("error");return}const E=K.current.map(V=>V.alpha),te=E.reduce((V,B)=>V+B,0)/E.length,H=Math.sqrt(E.reduce((V,B)=>V+Math.pow(B-te,2),0)/E.length);let _="ضعیف",ie=20,J="error",le="نیاز به کالیبراسیون — گوشی را به شکل ۸ انگلیسی حرکت دهید",q=e.jsx(it,{color:"error",fontSize:"large"}),G="#fffbe6";H<5?(_="عالی",ie=100,J="success",le="کالیبراسیون عالی — قطب‌نما آماده استفاده است",q=e.jsx(lt,{color:"success",fontSize:"large"}),G="#e6fce6"):H<15?(_="خوب",ie=70,J="warning",le="کالیبراسیون خوب — مناسب برای اغلب کاربردها",q=e.jsx(lt,{color:"warning",fontSize:"large"}),G="#fffbe6"):H<30&&(_="متوسط",ie=40,J="warning",le="کالیبراسیون متوسط — بهتر است گوشی را دوباره کالیبره کنید",q=e.jsx(st,{color:"warning",fontSize:"large"}),G="#fffbe6"),S(_),x(ie),v(J),M(_),ee(q),ye(G),i(le),u("±"+H.toFixed(1)+"°")};return Ae.useEffect(()=>()=>{window.removeEventListener("deviceorientation",xe)},[]),Ae.useEffect(()=>{const E=document.createElement("style");return E.innerHTML=`
      @keyframes spin { from {transform: rotate(0deg);} to {transform: rotate(360deg);} }
    `,document.head.appendChild(E),()=>{document.head.removeChild(E)}},[]),e.jsxs(O,{sx:{maxWidth:400,width:"100vw",minHeight:"100vh",mx:"auto",p:{xs:1,sm:2},bgcolor:"#fafbfc",borderRadius:{xs:0,sm:5},boxShadow:{xs:0,sm:6},direction:"rtl",fontFamily:"'Vazirmatn', 'Vazir', Arial, sans-serif",display:"flex",flexDirection:"column",justifyContent:"flex-start",position:"relative"},children:[e.jsx(W,{onClick:()=>ge("/"),sx:{position:"absolute",top:10,left:10,zIndex:10,bgcolor:"#fff",boxShadow:1},children:e.jsx(at,{})}),e.jsx(I,{variant:"h5",fontWeight:"bold",align:"center",color:"primary",mb:2,sx:{letterSpacing:"0.5px",mt:2,mb:2},children:"🧭 بررسی کالیبراسیون قطب‌نما"}),e.jsx(xn,{in:!0,children:e.jsxs(ve,{elevation:2,sx:{mb:2,py:2,px:1,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:je,borderRadius:3,transition:"background 0.6s"},children:[e.jsx(O,{sx:{mb:1},children:fe}),e.jsx(I,{fontWeight:"bold",fontSize:20,sx:{my:.5},children:A}),e.jsx(I,{variant:"body2",sx:{color:"#888",mb:-1,textAlign:"center"},children:R})]})}),e.jsxs(O,{display:"flex",gap:1,mb:2,children:[e.jsxs(O,{sx:{flex:1,bgcolor:"#e6fce6",borderRadius:2,px:2,py:1,textAlign:"center"},children:[e.jsx(I,{fontSize:13,color:"#55a84f",children:"دقت"}),e.jsx(I,{fontWeight:"bold",fontSize:19,color:"#388e3c",children:f==="--"?"--":f})]}),e.jsxs(O,{sx:{flex:1,bgcolor:"#e3f2fd",borderRadius:2,px:2,py:1,textAlign:"center"},children:[e.jsx(I,{fontSize:13,color:"#1976d2",children:"جهت فعلی"}),e.jsx(I,{fontWeight:"bold",fontSize:19,color:"#1976d2",children:g==="--"?"--":g})]})]}),e.jsxs(ve,{elevation:1,sx:{mb:2,p:1.5,bgcolor:"#f7f8fa",borderRadius:3,minHeight:72},children:[e.jsxs(I,{fontWeight:"bold",fontSize:15,sx:{mb:1},children:[e.jsx("span",{role:"img","aria-label":"chart",children:"📊"})," داده‌های سنسور:"]}),e.jsxs(O,{sx:{display:"flex",gap:1.5,alignItems:"center",mb:1,justifyContent:"center"},children:[e.jsxs(I,{fontFamily:"monospace",fontSize:15,color:"#1976d2",children:["Alpha (Z): ",h]}),e.jsxs(I,{fontFamily:"monospace",fontSize:15,color:"#388e3c",children:["Beta (X): ",o]}),e.jsxs(I,{fontFamily:"monospace",fontSize:15,color:"#fb8c00",children:["Gamma (Y): ",d]})]}),e.jsxs(I,{variant:"caption",color:"#888",children:["تعداد خوانش: ",e.jsx("b",{children:c})]})]}),e.jsxs(O,{mb:1,mt:.5,children:[e.jsx(I,{fontSize:14,color:"#555",mb:.5,children:"کیفیت کالیبراسیون:"}),e.jsx(mn,{variant:"determinate",value:C,color:m,sx:{height:7,borderRadius:2,bgcolor:"#ffd4d4","& .MuiLinearProgress-bar":{borderRadius:2}}}),e.jsx(I,{fontWeight:"bold",color:m==="success"?"#388e3c":m==="warning"?"#fb8c00":"#d32f2f",fontSize:15,sx:{mt:.5,textAlign:"center"},children:b})]}),e.jsxs(O,{display:"flex",gap:1.5,mb:2,mt:1,children:[e.jsx(U,{fullWidth:!0,size:"large",variant:"contained",color:t?"error":"primary",onClick:t?Se:me,sx:{fontWeight:"bold",fontSize:"16px",py:1.3},children:t?"⏹️ توقف":"🎯 شروع بررسی"}),e.jsx(U,{fullWidth:!0,size:"large",variant:"contained",color:"warning",onClick:()=>P(E=>!E),sx:{fontWeight:"bold",fontSize:"16px",py:1.3},children:"🔄 راهنمای کالیبراسیون"})]}),e.jsx(dt,{in:k,sx:{mb:2},children:e.jsxs(ve,{sx:{p:2,bgcolor:"#fffbe6",borderRight:"4px solid #ff9800",mb:2,borderRadius:2},children:[e.jsx(I,{fontWeight:"bold",mb:1,children:"📋 دستورات کالیبراسیون:"}),e.jsxs("ol",{style:{paddingRight:18,margin:0},children:[e.jsx("li",{children:"گوشی را در دست بگیرید"}),e.jsx("li",{children:"آن را به شکل عدد ۸ انگلیسی حرکت دهید"}),e.jsx("li",{children:"در همه جهات بچرخانید"}),e.jsx("li",{children:"حرکت را ۱۵ ثانیه ادامه دهید"})]})]})}),e.jsx(U,{startIcon:e.jsx(at,{}),onClick:()=>ge("/"),fullWidth:!0,variant:"outlined",color:"secondary",sx:{mt:0,fontWeight:"bold",fontSize:"16px",py:1.2,borderRadius:3,bgcolor:"#f8f8f8","&:hover":{bgcolor:"#ececec"}},children:"بازگشت به نقشه"}),F&&e.jsx(I,{color:"error",fontWeight:"bold",align:"center",mt:1,children:F})]})}function sr(){const{hasUpdate:t,updateApp:r}=kn();return e.jsx("div",{style:{height:"100vh",width:"100vw",margin:0,padding:0,overflow:"hidden"},children:e.jsxs(jn,{theme:vn,children:[t&&e.jsx("div",{style:{position:"fixed",bottom:70,left:0,right:0,zIndex:9999,textAlign:"center"},children:e.jsx("button",{onClick:r,style:{padding:"14px 32px",borderRadius:10,fontWeight:"bold",fontSize:18,background:"#2196F3",color:"white",boxShadow:"0 2px 8px #0002",border:"none",cursor:"pointer"},children:"نسخه جدید آماده است! بروزرسانی"})}),e.jsx(yn,{basename:"/dataLogger",children:e.jsxs(bn,{children:[e.jsx(Ne,{path:"/",element:e.jsx(nr,{})}),e.jsx(Ne,{path:"/calibration",element:e.jsx(or,{})}),e.jsx(Ne,{path:"*",element:e.jsx(rr,{})})]})})]})})}Sn.createRoot(document.getElementById("root")).render(e.jsx(Ae.StrictMode,{children:e.jsx(sr,{})}));
